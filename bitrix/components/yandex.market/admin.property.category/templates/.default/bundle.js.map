{"version":3,"file":"bundle.js","sources":["src/CategoryField.js","src/Parameters/Row.js","src/Parameters/ValueType/Control.js","src/Parameters/ValueType/SelectSkeleton.js","src/Parameters/ValueType/InitialControl.js","src/Component/utils.js","src/Parameters/ValueType/TextControl.js","src/Parameters/ValueType/EnumControl.js","src/Parameters/ValueType/BooleanControl.js","src/Parameters/ValueType/NumberControl.js","src/Parameters/ParameterRow.js","src/Parameters/ValueType/Factory.js","src/Parameters/FactoryMenu.js","src/Parameters/Dto/Parameter.js","src/Parameters/Dto/ParameterCollection.js","src/Parameters/ParametersRegistry.js","src/Parameters/ValueType/ParentControl.js","src/Parameters/ParentRow.js","src/Parameters/Dto/UnknownParameter.js","src/ParametersField.js","src/Component/Transport.js","src/Component/Locale.js","src/Component/Form.js","src/Component/State.js","src/Parameters/ParametersPool.js","src/CategoryPanel.js","src/CategoryFactory.js"],"sourcesContent":["import type {Transport} from \"./Component/Transport\";\nimport type {Locale} from \"./Component/Locale\";\n\nconst $ = window.YMarketJQuery || window.jQuery;\n\nexport class CategoryField {\n\n    static defaults = {\n\t\tselectElement: 'select',\n\t    parentElement: '[data-entity=\"parentCategory\"]',\n\t    copyElement: '[data-entity=\"copy\"]',\n    }\n\n\t_bindSearchPaste = false;\n    _lastError;\n\n    constructor(element: HTMLSelectElement, transport: Transport, locale: Locale, options: Object = {}) {\n        this.$el = $(element);\n        this.el = element;\n        this.options = Object.assign({}, this.constructor.defaults, options);\n        this.transport = transport;\n        this.locale = locale;\n\n\t    this.bind();\n        this.bootSelect();\n    }\n\n\tdestroy() : void {\n\t\tthis.unbind();\n\t\tthis.destroySelect();\n\t}\n\n\tbind() {\n\t\tthis.handleSelectOpen(true);\n\t\tthis.handleSelectClose(true);\n\t\tthis.handleCopy(true);\n\t}\n\n\tunbind() {\n\t\tthis.handleSelectOpen(false);\n\t\tthis.handleSelectClose(false);\n\t\tthis.handleSearchPaste(false);\n\t\tthis.handleCopy(false);\n\t}\n\n\thandleChange(dir: boolean, callback: () => {}) : void {\n\t\tthis.selectElement()[dir ? 'on' : 'off']('change', callback);\n\t}\n\n\thandleCopy(dir: boolean) : void {\n\t\tthis.$el.find(this.options.copyElement)[dir ? 'on' : 'off']('click', this.onCopyClick);\n\t}\n\n\thandleSelectOpen(dir: boolean) : void {\n\t\tthis.selectElement()[dir ? 'on' : 'off']('select2:open', this.onSelectOpen);\n\t}\n\n\thandleSelectClose(dir: boolean) : void {\n\t\tthis.selectElement()[dir ? 'on' : 'off']('select2:closing', this.onSelectClosing);\n\t}\n\n\thandleSearchPaste(dir: boolean) : void {\n\t\tif (this._bindSearchPaste === dir) { return; }\n\n\t\tconst search = $('.select2-search__field');\n\n\t\tsearch[dir ? 'on' : 'off']('paste', this.onSearchPaste);\n\t\tthis._bindSearchPaste = dir;\n\t}\n\n\tonCopyClick = () : void => {\n\t\tthis.copyClipboard(this.value() || this.parentValue());\n\t}\n\n\tonSelectOpen = () : void => {\n\t\tthis.handleSearchPaste(true);\n\t}\n\n\tonSelectClosing = () : void => {\n\t\tthis.handleSearchPaste(false);\n\t}\n\n\tonSearchPaste = (e) : void => {\n\t\tconst paste = (e.originalEvent.clipboardData || window.clipboardData).getData('text/plain').toString();\n\t\tconst lines = paste.split(/(\\n\\r|\\n|\\r)/gm).map((line) => line.trim()).filter((line) => line !== '');\n\n\t\tif (paste.indexOf(' / ') !== -1 || lines.length < 2) { return; }\n\n\t\te.target.value = lines.join(' / ');\n\t\te.preventDefault();\n\n\t\t$(e.target).trigger('input');\n\t}\n\n    bootSelect() : void {\n        this.selectElement().select2(Object.assign({}, {\n\t        width: '100%',\n            minimumInputLength: 2,\n            selectOnClose: true,\n\t        allowClear: true,\n            ajax: {\n                cache: true,\n                delay: 1000,\n                transport: this.ajaxTransport,\n            },\n            templateSelection: this.templateSelection,\n        }, this.getLanguageOptions()));\n    }\n\n\tdestroySelect() : void {\n\t\tthis.selectElement().select2('destroy');\n\t}\n\n    getLanguageOptions() : Object {\n        return {\n            placeholder: this.parentValue() || this.locale.message('CATEGORY_PLACEHOLDER'),\n            language: Object.assign(this.languageDefaults(), {\n                errorLoading: () => {\n                    if (this._lastError != null) {\n                        const error = this._lastError;\n                        this._lastError = null;\n\n                        return error;\n                    }\n\n                    return this.locale.message('CATEGORY_LOAD_ERROR');\n                },\n            }),\n        }\n    }\n\n    languageDefaults() : Object {\n        try {\n            // noinspection JSUnresolvedReference\n\t        return $.fn.select2.amd.require(`select2/i18n/${this.locale.language()}`)\n        } catch (e) {\n            console.error(e);\n            return {};\n        }\n    }\n\n    ajaxTransport = (params: Object, success: () => {}, failure: () => {}) : void => {\n\t    if (/.+\\/.+\\[\\d+]/.test(params.data.q)) {\n\t\t    success(this.prepareResults([params.data.q]));\n\t\t    return;\n\t    }\n\n        this.transport.fetch('categories', {\n            query: params.data.q,\n            language: this.locale.language(),\n        })\n            .then((data) => {\n                success(this.prepareResults(data));\n            })\n            .catch((error: Error) => {\n                this._lastError = error.message;\n                failure();\n            });\n\n        return {};\n    }\n\n\tprepareResults(variants: string[]) {\n\t\treturn {\n\t\t\tresults: variants.map((variant: string) => {\n\t\t\t\treturn {id: variant, text: variant};\n\t\t\t}),\n\t\t};\n\t}\n\n    templateSelection = (variant: Object) : string => {\n        return variant.id === '' ? variant.text : variant.id;\n    }\n\n\tcopyClipboard(text: string) : void {\n\t\tconst fake = $('<textarea></textarea>').css({\n\t\t\tposition: 'absolute',\n\t\t\tleft: '-9999px',\n\t\t\ttop: '-9999px',\n\t\t});\n\n\t\tfake.insertAfter(this.$el);\n\t\tfake.val(text);\n\t\tfake[0].select();\n\n\t\tthis.execCommand('copy');\n\n\t\tfake.remove();\n\t}\n\n\texecCommand(command: string) : boolean {\n\t\ttry {\n\t\t\t// noinspection JSDeprecatedSymbols\n\t\t\tdocument.execCommand(command);\n\t\t\treturn true;\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tselectElement() {\n\t\treturn this.$el.find(this.options.selectElement);\n\t}\n\n\tresetParent(category: string) : void {\n\t\tconst placeholder = category || this.locale.message('CATEGORY_PLACEHOLDER');\n\n\t\tthis.$el.find(this.options.parentElement).val(category || '');\n\n\t\tthis.$el.find('.select2-selection__rendered').attr('title', placeholder)\n\t\tthis.$el.find('.select2-selection__placeholder').text(placeholder);\n\t}\n\n\tparentValue() : string {\n\t\treturn this.$el.find(this.options.parentElement).val();\n\t}\n\n\tvalue() : ?string {\n\t\treturn this.selectElement().val();\n\t}\n}","import type {ParametersField} from \"../ParametersField\";\nimport type {Parameter} from \"./Dto/Parameter\";\nimport type {Control} from \"./ValueType/Control\";\n\nconst BX = window.BX;\n\nexport class Row {\n\n\tstatic defaults = {\n\t\tid: null,\n\t\thintElement: '[data-entity=\"hint\"]',\n\t\tfieldElement: '[data-entity=\"field\"]',\n\t\tvalueElement: '[data-entity=\"value\"]',\n\t}\n\n\tcontrol: Control;\n\t_hintHover: boolean;\n\n\tconstructor(element: HTMLElement, field: ParametersField, options: Object = {}) {\n\t\tthis.el = element;\n\t\tthis.field = field;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, this.el.dataset, options);\n\t\tthis.id = +(this.options.id || this.el.dataset.id);\n\t}\n\n\tdestroy() : void {\n\t\tthis.field.parametersRegistry.stopWait(this.id, this.onParameterWait);\n\t\tthis.handleHintHover(false);\n\t\tthis.control.destroy();\n\t\tthis.control = null;\n\t\tthis.options = null;\n\t\tthis.el = null;\n\t}\n\n\tinitial() : void {\n\t\tthis.handleHintHover(true);\n\t\tthis.control = this.initialControl();\n\t\tthis.field.parametersRegistry.wait(this.id, this.onParameterWait);\n\t}\n\n\tonParameterWait = (parameter: Parameter) : void => {\n\t\tthis.render(parameter, this.field.values());\n\t}\n\n\tinitialControl() : Control {\n\t\tthrow new Error('not implemented');\n\t}\n\n\tinitialLoad() : Promise {\n\t\treturn this.field.parametersRegistry.initialLoad();\n\t}\n\n\trender(parameter: Parameter, values: Object<number, string|string[]>) : void {\n\t\tthis.handleHintHover(false);\n\t\tthis.setHint(parameter.description());\n\t\tthis.setRequired(parameter.required());\n\t\tthis.renderControl(parameter, values);\n\t}\n\n\trenderControl(parameter: Parameter, values: Object<number, string|string[]>) : void {\n\t\tif (this.control != null) {\n\t\t\tconst name = this.control.el.name.replace(/\\[]$/, '');\n\t\t\tconst value = this.control.value();\n\t\t\tconst focused = this.control.focused();\n\n\t\t\tthis.control.el.remove();\n\t\t\tthis.control.destroy();\n\n\t\t\tthis.control = this.parameterControl(parameter, name, values);\n\t\t\tthis.control.setValue(value);\n\n\t\t\tif (focused) {\n\t\t\t\tthis.control.focus();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.control = this.parameterControl(parameter, `${this.options.name}[VALUE]`, values);\n\t}\n\n\tparameterControl(parameter: Parameter, name: string, values: Object<number, string|string[]>) : Control {\n\t\tthrow new Error('not implemented');\n\t}\n\n\thandleHintHover(dir: boolean) : void {\n\t\tconst hint = this.el.querySelector(this.options.hintElement);\n\n\t\thint[dir ? 'addEventListener' : 'removeEventListener']('mouseenter', this.onHintEnter);\n\t\thint[dir ? 'addEventListener' : 'removeEventListener']('mouseleave', this.onHintLeave);\n\t}\n\n\tonHintEnter = () : void => {\n\t\tif (this._hintHover == null) {\n\t\t\tthis.initialLoad().then(() => {\n\t\t\t\tthis.handleHintHover(false);\n\t\t\t\t// noinspection JSUnresolvedReference\n\t\t\t\tthis._hintHover && this._hint && this._hint.Show();\n\t\t\t});\n\t\t}\n\n\t\tthis._hintHover = true;\n\t}\n\n\tonHintLeave = () : void => {\n\t\tthis._hintHover = false;\n\t}\n\n\tsetHint(text: ?string) : void {\n\t\tconst hint = this.el.querySelector(this.options.hintElement);\n\n\t\tif (!text) {\n\t\t\t// noinspection JSUnresolvedReference\n\t\t\tthis._hint && this._hint.Destroy();\n\t\t\tthis._hint = null;\n\t\t\thint.classList.add('is--hidden');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._hint != null) {\n\t\t\t// noinspection JSUnresolvedReference\n\t\t\tthis._hint.CONTENT ? this._hint.setContent(text) : (this._hint.HINT = text);\n\t\t\treturn;\n\t\t}\n\n\t\thint.classList.remove('is--hidden');\n\n\t\t// noinspection JSUnresolvedReference\n\t\tthis._hint = new BX.CHint({\n\t\t\tparent: hint,\n\t\t\thint: text,\n\t\t\tshow_timeout: 30,\n\t\t});\n\t}\n\n\tsetRequired(required: boolean) : void {\n\t\tthis.el.classList[required ? 'add' : 'remove']('is--required');\n\t}\n\n\tsetValue(value: string|string[]) : void {\n\t\tthis.control.setValue(value);\n\t}\n\n\tvalue() {\n\t\treturn this.control.value();\n\t}\n}","export class Control {\n\n\tconstructor(element: HTMLInputElement|HTMLSelectElement) {\n\t\tthis.el = element;\n\t}\n\n\tdestroy() : void {\n\t\tthis.el = null;\n\t}\n\n\tboot() : void {}\n\n\tvalue(): string|string[] {\n\t\treturn this.el.value;\n\t}\n\n\tsetValue(value: string|string[]) : void {\n\t\tthis.el.value = value != null ? value : '';\n\t}\n\n\tfocused(): boolean {\n\t\treturn (document.activeElement === this.el);\n\t}\n\n\tfocus() {\n\t\tthis.el.focus();\n\t}\n}","// noinspection JSUnresolvedVariable\nimport {Control} from \"./Control\";\n\nconst $ = window.YMarketJQuery ?? window.$;\n\nexport class SelectSkeleton extends Control {\n\n\tconstructor(element: HTMLSelectElement, language: string) {\n\t\tsuper(element);\n\t\tthis.$el = $(element);\n\t\tthis.language = language;\n\t}\n\n\tboot() : void {\n\t\tthis.$el.select2({\n\t\t\twidth: '100%',\n\t\t\tlanguage: this.language,\n\t\t\ttags: this.allowedCustom(),\n\t\t});\n\t}\n\n\tallowedCustom() : boolean {\n\t\treturn {};\n\t}\n\n\tdestroy() : void {\n\t\tthis.$el.select2('destroy');\n\t}\n\n\tvalue() : string|string[] {\n\t\tif (!this.el.multiple) { return this.el.value; }\n\n\t\tconst selected = [];\n\n\t\tfor (const option of this.el.querySelectorAll('option')) {\n\t\t\tif (option.selected) {\n\t\t\t\tselected.push(option.value);\n\t\t\t}\n\t\t}\n\n\t\treturn selected;\n\t}\n\n\tsetValue(value: string|string[]) : void {\n\t\tconst selected = this._toArray(value);\n\t\tconst found = [];\n\t\tlet placeholder;\n\t\tlet first = true;\n\t\tlet changed = false;\n\n\t\tfor (const option of this.el.querySelectorAll('option')) {\n\t\t\tif (first && option.value === '') {\n\t\t\t\tplaceholder = option;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst matched = (selected.indexOf(option.value) !== -1);\n\n\t\t\tif (matched) {\n\t\t\t\tfound.push(option.value);\n\t\t\t}\n\n\t\t\tif (matched !== option.selected) {\n\t\t\t\toption.selected = matched;\n\t\t\t\tchanged = true;\n\t\t\t}\n\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (this.allowedCustom()) {\n\t\t\tfor (const selectedItem of selected) {\n\t\t\t\tif (found.indexOf(selectedItem) !== -1) { continue; }\n\n\t\t\t\tconst option = document.createElement('option');\n\t\t\t\toption.textContent = selectedItem;\n\n\t\t\t\tthis.el.appendChild(option);\n\t\t\t\toption.selected = true;\n\t\t\t\tfound.push(selectedItem);\n\n\t\t\t\tchanged = true;\n\t\t\t}\n\t\t}\n\n\t\tconst placeholderSelected = (found.length === 0);\n\n\t\tif (placeholder != null && placeholder.selected !== placeholderSelected) {\n\t\t\tplaceholder.selected = placeholderSelected;\n\t\t\tchanged = true;\n\t\t}\n\n\t\tchanged && this.$el.triggerHandler('change.select2');\n\t}\n\n\tfocus() : void {\n\t\tthis.$el.select2('close');\n\t\tthis.$el.select2('open');\n\t}\n\n\tfocused() : boolean {\n\t\treturn this.$el.select2('isOpen');\n\t}\n\n\t_toArray(value: string|string[]|null) : string[] {\n\t\tif (value == null) { return []; }\n\n\t\treturn Array.isArray(value) ? value : [ value ];\n\t}\n}","import {SelectSkeleton} from \"./SelectSkeleton\";\n\nexport class InitialControl extends SelectSkeleton {\n\n\t_focusCallback;\n\n\tdestroy() : void {\n\t\tthis.unbindFocus();\n\t\tsuper.destroy();\n\t}\n\n\tbindFocus(callback: () => {}) : void {\n\t\tthis._focusCallback = callback;\n\t\tthis.$el.on('select2:opening', callback);\n\t}\n\n\tunbindFocus() : void {\n\t\tif (this._focusCallback == null) { return; }\n\n\t\tthis.$el.off('select2:opening', this._focusCallback);\n\t\tthis._focusCallback = null;\n\t}\n}","export function compileTemplate(template, variables) {\n\tlet result = template;\n\n\tif (variables == null) { return result; }\n\n\tfor (const [key, value] of Object.entries(variables)) {\n\t\tconst marker = '#' + key + '#';\n\t\tlet previousPosition = -1;\n\t\tlet position = -1;\n\n\t\tdo {\n\t\t\tpreviousPosition = position;\n\t\t\tresult = result.replace(marker, value);\n\n\t\t\tposition = result.indexOf(marker);\n\t\t} while (position !== -1 && position > previousPosition);\n\t}\n\n\treturn result;\n}\n\nexport function htmlToElement(html, tag = 'div') {\n\tconst renderer = document.createElement(tag);\n\n\trenderer.innerHTML = html;\n\n\tif (tag === 'table') {\n\t\treturn renderer.firstElementChild.firstElementChild;\n\t}\n\n\treturn renderer.firstElementChild;\n}","import {Control} from \"./Control\";\nimport {htmlToElement} from \"../../Component/utils\";\nimport type {Parameter} from \"../Dto/parameter\";\n\nexport class TextControl extends Control {\n\n\tstatic make(parameter: Parameter, name: string) : TextControl {\n\t\tconst maxLength = parameter.maxLength();\n\n\t\treturn new TextControl(htmlToElement(`<input\n\t\t \tclass=\"ym-category-parameter__control adm-input\"\n\t\t\ttype=\"text\"\n\t\t\tname=\"${name}\"\n\t\t\t${maxLength != null ? `maxlength=\"${maxLength}\"` : ''}\n\t\t/>`));\n\t}\n\n}","import {htmlToElement} from \"../../Component/utils\";\nimport type {Parameter} from \"../Dto/Parameter\";\nimport {SelectSkeleton} from \"./SelectSkeleton\";\n\nexport class EnumControl extends SelectSkeleton {\n\n\tstatic make(parameter: Parameter, name: string, language: string) : EnumControl {\n\t\tconst multiple = parameter.multiple();\n\t\tconst element = htmlToElement(`<select class=\"ym-category-parameter__control\" name=\"${name}${multiple ? '[]' : ''}\" ${multiple ? 'multiple' : ''}>\n\t\t\t${multiple ? '' : '<option value=\"\" disabled></option>'}\n\t\t</select>`);\n\n\t\treturn new EnumControl(element,\tlanguage, parameter);\n\t}\n\n\t_changeCallback;\n\n\tconstructor(element: HTMLSelectElement, language: string, parameter: Parameter) {\n\t\tsuper(element, language);\n\t\tthis.parameter = parameter;\n\t}\n\n\tdestroy() : void {\n\t\tthis.parameter = null;\n\t\tthis.unbindChange();\n\t\tsuper.destroy();\n\t}\n\n\tallowedCustom(): boolean {\n\t\treturn this.parameter.allowCustom();\n\t}\n\n\tbindChange(callback: () => {}) : void {\n\t\tthis._changeCallback = callback;\n\t\tthis.$el.on('change', this._changeCallback);\n\t}\n\n\tunbindChange() : void {\n\t\tif (this._changeCallback == null) { return; }\n\n\t\tthis.$el.off('change', this._changeCallback);\n\t\tthis._changeCallback = null;\n\t}\n\n\treflow(selected: Object<number, string|string[]>) : void {\n\t\tconst selfSelected = this._toArray(selected[this.parameter.id()]);\n\t\tconst existOptions = this.el.querySelectorAll('option');\n\t\tconst placeholder = existOptions[0] && existOptions[0].disabled ? existOptions[0] : null;\n\t\tconst allowedCustom = this.allowedCustom();\n\t\tlet existIndex = placeholder != null ? 1 : 0; // after placeholder\n\t\tlet selectedFound = [];\n\n\t\tfor (const value of this._activeValues(selected)) {\n\t\t\tlet matchedOption;\n\n\t\t\twhile (existOptions[existIndex] != null) {\n\t\t\t\tconst existOption = existOptions[existIndex];\n\n\t\t\t\tif (existOption.dataset.id == null) { // custom\n\t\t\t\t\tif (allowedCustom && selfSelected.includes(existOption.value)) {\n\t\t\t\t\t\texistOption.selected = true;\n\t\t\t\t\t\tselectedFound.push(existOption.value);\n\t\t\t\t\t\t++existIndex;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else if (+existOption.dataset.id === value.id) {\n\t\t\t\t\tmatchedOption = existOption;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\texistOption.remove();\n\t\t\t\t++existIndex;\n\t\t\t}\n\n\t\t\tif (matchedOption == null) {\n\t\t\t\tconst anchor = existOptions[existIndex + 1];\n\t\t\t\tmatchedOption = document.createElement('option');\n\t\t\t\tmatchedOption.value = `${value.value} [${value.id}]`;\n\t\t\t\tmatchedOption.textContent = value.value;\n\t\t\t\tmatchedOption.dataset.id = value.id;\n\n\t\t\t\tif (anchor) {\n\t\t\t\t\tthis.el.insertBefore(matchedOption, anchor);\n\t\t\t\t} else {\n\t\t\t\t\tthis.el.appendChild(matchedOption);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst optionSelected = selfSelected.includes(matchedOption.value);\n\t\t\tmatchedOption.selected = optionSelected;\n\n\t\t\tif (optionSelected) {\n\t\t\t\tselectedFound.push(matchedOption.value);\n\t\t\t}\n\t\t}\n\n\t\tif (placeholder != null) {\n\t\t\tplaceholder.selected = (selectedFound.length === 0);\n\t\t}\n\t}\n\n\t_activeValues(selected: Object<number, string|string[]>) : Object[] {\n\t\tconst values = this.parameter.values();\n\t\tconst restricted = this._restricted(selected);\n\n\t\tif (restricted === null) { return values; }\n\n\t\tconst restrictedValues = [];\n\n\t\tfor (const value of values) {\n\t\t\tif (restricted.includes(value.id)) {\n\t\t\t\trestrictedValues.push(value);\n\t\t\t}\n\t\t}\n\n\t\treturn restrictedValues;\n\t}\n\n\t_restricted(selected: Object<number, string|string[]>) : ?number[] {\n\t\tconst restrictions = this.parameter.valueRestrictions();\n\n\t\tif (restrictions == null) { return null; }\n\n\t\tlet restricted = null;\n\n\t\tfor (const restriction of restrictions) {\n\t\t\tconst limitingId = restriction['limitingParameterId'];\n\n\t\t\tif (selected[limitingId] == null) { continue; }\n\n\t\t\tconst siblingValue = this._castOptionIds(selected[limitingId]);\n\n\t\t\tfor (const limitedValue of restriction['limitedValues']) {\n\t\t\t\tif (!siblingValue.includes(limitedValue['limitingOptionValueId'])) { continue; }\n\n\t\t\t\tif (restricted == null) {\n\t\t\t\t\trestricted = limitedValue['optionValueIds'];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst newRestricted = [];\n\n\t\t\t\tfor (const id of restricted) {\n\t\t\t\t\tif (limitedValue['optionValueIds'].includes(id)) {\n\t\t\t\t\t\tnewRestricted.push(id);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trestricted = newRestricted;\n\t\t\t}\n\t\t}\n\n\t\treturn restricted;\n\t}\n\n\t_castOptionIds(selected) : number[] {\n\t\tif (selected == null) { return []; }\n\n\t\treturn this._toArray(selected)\n\t\t\t.map((item: string) : ?number => {\n\t\t\t\tconst idMatches = /\\[(\\d+)]$/.exec(item);\n\t\t\t\treturn idMatches ? +idMatches[1] : null;\n\t\t\t})\n\t\t\t.filter((item: ?number) : boolean => item != null);\n\t}\n}","import {htmlToElement} from \"../../Component/utils\";\nimport type {Parameter} from \"../Dto/Parameter\";\nimport type {Locale} from \"../../Component/Locale\";\nimport {SelectSkeleton} from \"./SelectSkeleton\";\n\nexport class BooleanControl extends SelectSkeleton {\n\n\tstatic make(parameter: Parameter, name: string, locale: Locale) : BooleanControl {\n\t\tconst element = htmlToElement(`<select class=\"ym-category-parameter__control\" name=\"${name}\">\n\t\t\t<option value=\"Y\">${locale.message('BOOLEAN_Y')}</option>\n\t\t\t<option value=\"N\">${locale.message('BOOLEAN_N')}</option>\n\t\t</select>`);\n\n\t\treturn new BooleanControl(element, locale.language());\n\t}\n\n}","import {Control} from \"./Control\";\nimport {htmlToElement} from \"../../Component/utils\";\nimport type {Parameter} from \"../Dto/Parameter\";\n\nexport class NumberControl extends Control {\n\n\tstatic make(parameter: Parameter, name: string) : NumberControl {\n\t\tconst minValue = parameter.minValue();\n\t\tconst maxValue = parameter.maxValue();\n\n\t\treturn new NumberControl(htmlToElement(`<input\n \t\t\tclass=\"ym-category-parameter__control adm-input\" \n\t\t\ttype=\"number\" \n\t\t\tname=\"${name}\"\n\t\t\t${minValue != null ? `min=\"${minValue}\"` : ''}\n\t\t\t${maxValue != null ? `max=\"${maxValue}\"` : ''}\n\t\t/>`));\n\t}\n\n\tdestroy() : void {\n\t\tthis._handleInput(false);\n\t\tsuper.destroy();\n\t}\n\n\tboot() : void {\n\t\tthis._handleInput(true);\n\t}\n\n\t_handleInput(dir: boolean) : void {\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('input', this._onInput);\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('change', this._onChange);\n\t}\n\n\t_onInput = () => {\n\t\tconst value = parseFloat(this.el.value);\n\t\tconst valid = (\n\t\t\t!Number.isNaN(value)\n\t\t\t&& (this.el.min == null || value >= this.el.min)\n\t\t\t&& (this.el.max == null || value <= this.el.max)\n\t\t);\n\n\t\tthis._markInvalid(!valid);\n\t}\n\n\t_onChange = () => {\n\t\tconst value = parseFloat(this.el.value);\n\n\t\tif (isNaN(value)) {\n\t\t\tthis.el.value = '';\n\t\t} else if (this.el.min != null && value < this.el.min) {\n\t\t\tthis.el.value = this.el.min;\n\t\t} else if (this.el.max != null && value > this.el.max) {\n\t\t\tthis.el.value = this.el.max;\n\t\t}\n\n\t\tthis._markInvalid(false);\n\t}\n\n\t_markInvalid(dir : boolean) : void {\n\t\tthis.el.classList[dir ? 'add' : 'remove']('is--invalid');\n\t}\n}","import type {Parameter} from \"./Dto/Parameter\";\nimport {Row} from \"./Row\";\nimport {InitialControl} from \"./ValueType/InitialControl\";\nimport {htmlToElement} from \"../Component/utils\";\nimport type {ParametersField} from \"../ParametersField\";\nimport {Factory} from \"./ValueType/Factory\";\nimport type {Control} from \"./ValueType/Control\";\nimport {EnumControl} from \"./ValueType/EnumControl\";\n\nexport class ParameterRow extends Row {\n\n\tstatic defaults = Object.assign({}, Row.defaults, {\n\t\tname: null,\n\t\tdeleteElement: '[data-entity=\"delete\"]',\n\t});\n\n\tstatic make(parameter: Parameter, name: string, field: ParametersField) : ParameterRow {\n\t\tconst unit = parameter.defaultUnit();\n\t\tconst element = htmlToElement(`<tr class=\"ym-category-parameter\">\n\t\t\t<td class=\"ym-category-parameter__title\">\n\t\t\t\t<input type=\"hidden\" name=\"${name}[ID]\" value=\"${parameter.id()}\" />\n\t\t\t\t<input type=\"hidden\" name=\"${name}[NAME]\" value=\"${parameter.name()}\" />\n\t\t\t\t${unit != null \n\t\t\t\t\t? `<input type=\"hidden\" name=\"${name}[UNIT]\" value=\"${unit.name} [${unit.id}]\" />`\n\t\t\t\t\t: ''}\n\t\t\t\t<span class=\"ym-category-parameter__label\">${parameter.name()}${unit != null ? `, ${unit.name}` : ''}</span>\n\t\t\t\t<span class=\"ym-category-parameter__hint\" data-entity=\"hint\"></span>\n\t\t\t</td>\n\t\t\t<td class=\"ym-category-parameter__field\" data-entity=\"field\"></td>\n\t\t\t<td class=\"ym-category-parameter__actions\">\n\t\t\t\t<button class=\"ym-category-parameter__delete\" type=\"button\" data-entity=\"delete\">${field.locale.message('PARAMETER_DELETE')}</button>\n\t\t\t</td>\n        </tr>`, 'table');\n\n\t\treturn new ParameterRow(element, field, {\n\t\t\tid: parameter.id(),\n\t\t\tname: name,\n\t\t});\n\t}\n\n\tconstructor(element: HTMLElement, field: ParametersField, options: Object = {}) {\n\t\tsuper(element, field, options);\n\t\tthis.handleDelete(true);\n\t}\n\n\tdestroy() {\n\t\tthis.handleDelete(false);\n\t\tsuper.destroy();\n\t}\n\n\thandleDelete(dir: boolean) : void {\n\t\tconst button = this.el.querySelector(this.options.deleteElement);\n\n\t\tbutton[dir ? 'addEventListener' : 'removeEventListener']('click', this.onDelete);\n\t}\n\n\tonChange = () => {\n\t\tthis.field.reflowDepended(this.id);\n\t}\n\n\tonDelete = () => {\n\t\tthis.field.delete(this);\n\t\tthis.field.fireChange();\n\t}\n\n\tinitialControl() : InitialControl {\n\t\tconst control = new InitialControl(this.el.querySelector(this.options.valueElement), this.field.locale.language());\n\t\tcontrol.boot();\n\t\tcontrol.bindFocus(() => {\n\t\t\t// noinspection JSIgnoredPromiseFromCall\n\t\t\tthis.initialLoad();\n\t\t});\n\n\t\treturn control;\n\t}\n\n\treflow(values: Object<number, string|string[]>) : void {\n\t\tif (!(this.control instanceof EnumControl)) { return; }\n\n\t\tthis.control.reflow(values);\n\t}\n\n\trender(parameter: Parameter, values: Object<number, string|string[]>) : void {\n\t\tsuper.render(parameter, values);\n\t\tthis.setDeprecated(false);\n\t}\n\n\tparameterControl(parameter: Parameter, name: string, values: Object<number, string|string[]>) : Control {\n\t\tconst field = this.el.querySelector(this.options.fieldElement);\n\t\tconst control = Factory.make(parameter, name, this.field.locale);\n\n\t\tif (control instanceof EnumControl) {\n\t\t\tcontrol.reflow(values);\n\t\t\tcontrol.bindChange(this.onChange);\n\t\t}\n\n\t\tfield.appendChild(control.el);\n\t\tcontrol.boot();\n\n\t\treturn control;\n\t}\n\n\tmarkDeprecated(): void {\n\t\tthis.setDeprecated(true);\n\t\tthis.setRequired(false);\n\t\tthis.setHint(this.field.locale.message('PARAMETER_DEPRECATED'));\n\t}\n\n\tsetDeprecated(deprecated: boolean) : void {\n\t\tthis.el.classList[deprecated ? 'add' : 'remove']('is--deprecated');\n\t}\n}","import {Control} from \"./Control\";\nimport {TextControl} from \"./TextControl\";\nimport {EnumControl} from \"./EnumControl\";\nimport {BooleanControl} from \"./BooleanControl\";\nimport {NumberControl} from \"./NumberControl\";\nimport type {Parameter} from \"../Dto/Parameter\";\nimport type {Locale} from \"../../Component/Locale\";\n\nexport class Factory {\n\n\tstatic make(parameter: Parameter, name: string, locale: Locale) : Control {\n\t\tconst type = parameter.type();\n\n\t\tif (type === 'ENUM') {\n\t\t\treturn EnumControl.make(parameter, name, locale.language());\n\t\t} else if (type === 'BOOLEAN') {\n\t\t\treturn BooleanControl.make(parameter, name, locale);\n\t\t} else if (type === 'NUMERIC') {\n\t\t\treturn NumberControl.make(parameter, name);\n\t\t}\n\n\t\treturn TextControl.make(parameter, name);\n\t}\n}","import type {Parameter} from \"./Dto/parameter\";\nimport type {Locale} from \"../Component/Locale\";\nimport type {ParametersField} from \"../ParametersField\";\nimport type {ParameterCollection} from \"./Dto/ParameterCollection\";\nimport {Row} from \"./Row\";\n\nconst BX = window.BX;\n\nexport class FactoryMenu {\n\n\t_opening = false;\n\n\tconstructor(element: HTMLElement, field: ParametersField, locale: Locale) {\n\t\tthis.el = element;\n\t\tthis.field = field;\n\t\tthis.locale = locale;\n\t\t// noinspection JSUnresolvedReference\n\t\tthis._menu = new BX.CMenu({ parent: this.el });\n\n\t\tthis.handleClick(true);\n\t}\n\n\tdestroy() : void {\n\t\tthis._menu = null; // no way to destroy\n\t\tthis.handleClick(false);\n\t}\n\n\thandleClick(dir: boolean) : void {\n\t\tthis.el[dir ? 'addEventListener' : 'removeEventListener']('click', this.onClick);\n\t}\n\n\tonClick = (evt: PointerEvent) : void => {\n\t\tevt.preventDefault();\n\n\t\tif (this._opening || this.isOpen()) { return; }\n\n\t\tthis._opening = true;\n\n\t\tthis.field.parametersRegistry.collection()\n\t\t\t.then((parameterCollection: ParameterCollection) => {\n\t\t\t\tthis._opening = false;\n\t\t\t\tthis.open(parameterCollection);\n\t\t\t})\n\t\t\t.catch((error: Error) => {\n\t\t\t\tthis._opening = false;\n\t\t\t\tthis.field.state.error(error);\n\t\t\t});\n\t}\n\n\tisOpen() : boolean {\n\t\tif (this._menu == null) { return false; }\n\n\t\treturn (this._menu.DIV.style.display || '').toLowerCase() === 'block';\n\t}\n\n\topen(parameterCollection: ParameterCollection) : void {\n\t\tif (parameterCollection.count() === 0) {\n\t\t\tthis.field.state.error(new Error(this.locale.message('EMPTY_PROPERTIES')));\n\t\t\treturn;\n\t\t}\n\n\t\t// noinspection JSUnresolvedReference\n\t\tthis._menu.setItems(this.menuItems(parameterCollection));\n\t\t// noinspection JSUnresolvedReference\n\t\tthis._menu.Show();\n\t}\n\n\tselect(parameter: Parameter) : void {\n\t\tthis.field.add(parameter);\n\t}\n\n\tmenuItems(parameterCollection: ParameterCollection) : Array {\n\t\tconst exists = this.field.rows.map((row: Row) : number => row.id)\n\t\tconst filled = this.field.rows.filter((row: Row) : boolean => !!row.value()).map((row: Row) : number => row.id);\n\t\tconst parameters = this.availableParameters(parameterCollection, exists, filled);\n\t\tconst result = [];\n\n\t\tfor (const parameter of parameters) {\n\t\t\tresult.push({\n\t\t\t\tTEXT: `${parameter.name()}${parameter.required() ? '*' : ''}`,\n\t\t\t\tHTML: `${parameter.name()}${parameter.required() ? '<span class=\"ym-category-required-flag\">*</span>' : ''}`,\n\t\t\t\tONCLICK: () => this.select(parameter),\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tavailableParameters(parameterCollection: ParameterCollection, exists: number[], filled: number[]) : Parameter[] {\n\t\tconst result = [];\n\n\t\tfor (const parameter of parameterCollection.all()) {\n\t\t\tif (exists.includes(parameter.id())) { continue; }\n\n\t\t\tif (parameter.shownDependsOn(filled)) {\n\t\t\t\tresult.push(parameter);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n}","export class Parameter {\n\tstatic GROUP_ID = 200;\n\n\tconstructor(fields: Object) {\n\t\tthis.fields = fields;\n\t}\n\n\tid(): number {\n\t\treturn +this.fields['id'];\n\t}\n\n\ttype(): string {\n\t\treturn this.fields['type'];\n\t}\n\n\tmultiple(): boolean {\n\t\treturn !!this.fields['multivalue'];\n\t}\n\n\trequired(): boolean {\n\t\treturn !!this.fields['required'];\n\t}\n\n\tallowCustom(): boolean {\n\t\treturn !!this.fields['allowCustomValues'];\n\t}\n\n\tdescription(): string {\n\t\treturn this.fields['description'];\n\t}\n\n\tname(): string {\n\t\treturn this.fields['name'];\n\t}\n\n\tvalues(): Array {\n\t\treturn this.fields['values'] ?? [];\n\t}\n\n\tmaxLength(): string {\n\t\treturn this.fields['constraints']?.maxLength;\n\t}\n\n\tminValue(): string {\n\t\treturn this.fields['constraints']?.minValue;\n\t}\n\n\tmaxValue(): string {\n\t\treturn this.fields['constraints']?.maxValue;\n\t}\n\n\tvalueRestrictions(): Array|null {\n\t\treturn this.fields['valueRestrictions'];\n\t}\n\n\tshowByDefault(): boolean {\n\t\treturn this.required() && this.id() !== Parameter.GROUP_ID;\n\t}\n\n\tdefaultUnit() : ?{id: number, name: string} {\n\t\tif (this.fields['unit'] == null) { return null; }\n\n\t\tfor (const item of this.fields['unit']['units']) {\n\t\t\tif (this.fields['unit']['defaultUnitId'] === item.id) {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdependsOn(id: number) : boolean {\n\t\tconst restrictions = this.valueRestrictions();\n\n\t\tif (restrictions == null) { return false; }\n\n\t\tfor (const restriction of restrictions) {\n\t\t\tif (restriction['limitingParameterId'] === id) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tshownDependsOn(ids: number[]) : boolean {\n\t\tconst restrictions = this.valueRestrictions();\n\n\t\tif (restrictions == null) { return true; }\n\n\t\tfor (const restriction of restrictions) {\n\t\t\tif (ids.includes(restriction['limitingParameterId'])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n}","import {Parameter} from \"./Parameter\";\n\nexport class ParameterCollection {\n\n\tconstructor(parameters: Array) {\n\t\tthis.collection = parameters.map((fields) => new Parameter(fields));\n\t}\n\n\tcount() : number {\n\t\treturn this.collection.length;\n\t}\n\n\tall(): Parameter[] {\n\t\treturn this.collection;\n\t}\n\n\titem(id: number) : ?Parameter {\n\t\tid = +id;\n\n\t\tfor (const property of this.collection) {\n\t\t\tif (property.id() === id) {\n\t\t\t\treturn property;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdependentOf(id: number): Parameter[] {\n\t\tconst result = [];\n\n\t\tfor (const other of this.collection) {\n\t\t\tif (other.dependsOn(id)) {\n\t\t\t\tresult.push(other);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n}","import type {CategoryField} from \"../CategoryField\";\nimport {ParameterCollection} from \"./Dto/ParameterCollection\";\nimport type {Parameter} from \"./Dto/Parameter\";\nimport type {State} from \"../Component/State\";\nimport type {ParametersPool} from \"./ParametersPool\";\n\nexport class ParametersRegistry {\n\n\t_parameters: ParameterCollection;\n\t_parametersPromise: Promise<ParameterCollection>;\n\t_parametersResolve;\n\t_itemWaiting = [];\n\n\tconstructor(category: CategoryField, parametersPool: ParametersPool, state: State, locale: Locale) {\n\t\tthis.category = category;\n\t\tthis.parametersPool = parametersPool;\n\t\tthis.state = state;\n\t\tthis.locale = locale;\n\t}\n\n\tinitialLoad() : Promise {\n\t\tif (this._parameters != null) { return Promise.resolve(this._parameters); }\n\n\t\treturn this.fetch();\n\t}\n\n\tloaded() : boolean {\n\t\treturn this._parameters != null;\n\t}\n\n\treset(parameterCollection: ParameterCollection) : void {\n\t\tthis._parameters = parameterCollection;\n\t\tthis.resolveWaiting();\n\t\tthis.resolveFetch();\n\t}\n\n\tcollection() : Promise<ParameterCollection> {\n\t\tif (this._parameters != null) { return Promise.resolve(this._parameters); }\n\n\t\treturn this.fetch();\n\t}\n\n\tstopWait(id: number, callback: () => {}) : void {\n\t\tfor (const index of this._itemWaiting.keys()) {\n\t\t\tconst [waitingId, waitingCallback] = this._itemWaiting[index];\n\n\t\t\tif (waitingId === id && waitingCallback === callback) {\n\t\t\t\tthis._itemWaiting.splice(index, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\twait(id: number, callback: () => {}) : void {\n\t\tif (this._parameters != null) {\n\t\t\tthis.resolveWaitingItem(id, callback);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._itemWaiting.push([ id, callback ]);\n\t}\n\n\tresolveWaiting() : void {\n\t\tfor (const [id, callback] of this._itemWaiting) {\n\t\t\tthis.resolveWaitingItem(id, callback);\n\t\t}\n\n\t\tthis._itemWaiting = [];\n\t}\n\n\tresolveWaitingItem(id: number, callback: () => {}) : void {\n\t\tconst parameter = this._parameters.item(id);\n\n\t\tif (parameter == null) { return; }\n\n\t\tcallback(parameter);\n\t}\n\n\titem(id: number) : Promise<Parameter> {\n\t\treturn this.collection()\n\t\t\t.then((parameterCollection: ParameterCollection) => {\n\t\t\t\tconst item = parameterCollection.item(id);\n\n\t\t\t\tif (item == null) {\n\t\t\t\t\tthrow new Error(`not found parameter {id}`);\n\t\t\t\t}\n\n\t\t\t\treturn item;\n\t\t\t});\n\t}\n\n\tfetch() : Promise<ParameterCollection> {\n\t\tif (this._parametersPromise != null) { return this._parametersPromise; }\n\n\t\tthis._parametersPromise = new Promise((resolve, reject) => {\n\t\t\tconst category = this.category.value() || this.category.parentValue();\n\n\t\t\tif (!category) {\n\t\t\t\treject(new Error(this.locale.message('CATEGORY_EMPTY')));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._parametersResolve = resolve;\n\t\t\tthis.state.loading();\n\n\t\t\tthis.parametersPool.get(category)\n\t\t\t\t.then((parameterCollection) => {\n\t\t\t\t\tthis._parametersResolve = null;\n\t\t\t\t\tthis._parametersPromise = null;\n\t\t\t\t\tthis.state.waiting();\n\t\t\t\t\tthis.reset(parameterCollection);\n\t\t\t\t\tresolve(parameterCollection);\n\t\t\t\t})\n\t\t\t\t.catch((error: Error) => {\n\t\t\t\t\tthis._parametersResolve = null;\n\t\t\t\t\tthis._parametersPromise = null;\n\t\t\t\t\tthis.state.error(error);\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\n\t\treturn this._parametersPromise;\n\t}\n\n\tresolveFetch() : void {\n\t\tif (this._parametersResolve == null) { return; }\n\n\t\tthis._parametersResolve(this._parameters);\n\t\tthis._parametersResolve = null;\n\t\tthis._parametersPromise = null;\n\t}\n}","import {SelectSkeleton} from \"./SelectSkeleton\";\nimport type {Parameter} from \"../Dto/Parameter\";\nimport {htmlToElement} from \"../../Component/utils\";\n\nexport class ParentControl extends SelectSkeleton {\n\n\tstatic make(parameter: Parameter, language: string) : ParentControl {\n\t\tconst multiple = parameter.multiple();\n\n\t\treturn new ParentControl(\n\t\t\thtmlToElement(`<select class=\"ym-category-parameter__control\" ${multiple ? 'multiple' : ''} disabled></select>`),\n\t\t\tlanguage\n\t\t);\n\t}\n\n\tsetValue(value: string|string[]) : void {\n\t\tthis.el.innerHTML = '';\n\n\t\tfor (const item of this._toArray(value)) {\n\t\t\tconst idMatches = /^(.*)\\s\\[\\d+]$/.exec(item);\n\t\t\tconst option = document.createElement('option');\n\n\t\t\tif (idMatches !== null) {\n\t\t\t\toption.value = item;\n\t\t\t\toption.textContent = idMatches[1];\n\t\t\t} else {\n\t\t\t\toption.textContent = item;\n\t\t\t}\n\n\t\t\toption.selected = true;\n\t\t\tthis.el.appendChild(option);\n\t\t}\n\t}\n\n\tallowedCustom() : boolean {\n\t\treturn true;\n\t}\n}","import type {ParametersField} from \"../ParametersField\";\nimport type {Parameter} from \"./Dto/Parameter\";\nimport type {Control} from \"./ValueType/Control\";\nimport {ParentControl} from \"./ValueType/ParentControl\";\nimport {Row} from \"./Row\";\nimport {htmlToElement} from \"../Component/utils\";\n\nexport class ParentRow extends Row {\n\n\tstatic make(parameter: Parameter, field: ParametersField) : ParentRow {\n\t\tconst unit = parameter.defaultUnit();\n\t\tconst element = htmlToElement(`<tr class=\"ym-category-parameter\">\n\t\t\t<td class=\"ym-category-parameter__title\">\n\t\t\t\t<span class=\"ym-category-parameter__label\">${parameter.name()}${unit != null ? `, ${unit.name}` : ''}</span>\n\t\t\t\t<span class=\"ym-category-parameter__hint\" data-entity=\"hint\"></span>\n\t\t\t</td>\n\t\t\t<td class=\"ym-category-parameter__field\" data-entity=\"field\"></td>\n\t\t\t<td class=\"ym-category-parameter__actions\"></td>\n        </tr>`, 'table');\n\n\t\treturn new ParentRow(element, field, {\n\t\t\tid: parameter.id(),\n\t\t});\n\t}\n\n\tinitialControl() : Control {\n\t\tconst control = new ParentControl(this.el.querySelector(this.options.valueElement), this.field.locale.language());\n\t\tcontrol.boot();\n\n\t\treturn control;\n\t}\n\n\tparameterControl(parameter: Parameter, name: string, values: Object<number, string|string[]>): Control {\n\t\tconst field = this.el.querySelector(this.options.fieldElement);\n\t\tconst control = ParentControl.make(parameter, this.field.locale.language());\n\n\t\tfield.appendChild(control.el);\n\t\tcontrol.boot();\n\n\t\treturn control;\n\t}\n}","import {Parameter} from \"./Parameter\";\nimport type {Locale} from \"../../Component/Locale\";\n\nexport class UnknownParameter extends Parameter {\n\tconstructor(id: number, multiple: boolean, locale: Locale) {\n\t\tsuper({\n\t\t\tid: id,\n\t\t\tmultivalue: multiple,\n\t\t\ttitle: locale.message('UNKNOWN_PARAMETER', { 'ID': id }),\n\t\t});\n\t}\n}","import {ParameterRow} from \"./Parameters/ParameterRow\";\nimport {FactoryMenu} from \"./Parameters/FactoryMenu\";\nimport {ParameterCollection} from \"./Parameters/Dto/ParameterCollection\";\nimport type {Parameter} from \"./Parameters/Dto/Parameter\";\nimport type {Locale} from \"./Component/Locale\";\nimport {ParametersRegistry} from \"./Parameters/ParametersRegistry\";\nimport {ParentRow} from \"./Parameters/ParentRow\";\nimport type {Row} from \"./Parameters/Row\";\nimport {UnknownParameter} from \"./Parameters/Dto/UnknownParameter\";\nimport type {State} from \"./Component/State\";\n\nconst $ = window.YMarketJQuery ?? window.$;\n\nexport class ParametersField {\n\n\tstatic defaults = {\n\t\tname: null,\n\t\tparentRowElement: '[data-entity=\"parentRow\"]',\n\t\trowElement: '[data-entity=\"parameterRow\"]',\n\t\taddElement: '[data-entity=\"parametersFactory\"]',\n\t\thintElement: '[data-entity=\"addHint\"]',\n\t};\n\n\trows: Row[];\n\trowsIndex;\n\n\tconstructor(element: HTMLElement, parametersRegistry: ParametersRegistry, state: State, locale: Locale, options: Object = {}) {\n\t\tthis.el = element;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t\tthis.state = state;\n\t\tthis.locale = locale;\n\t\tthis.parametersRegistry = parametersRegistry;\n\t\tthis.factoryMenu = new FactoryMenu(this.el.parentElement.querySelector(this.options.addElement), this, this.locale);\n\n\t\tthis.bootHint();\n\t\tthis.bootRows();\n\t}\n\n\tdestroy() : void {\n\t\tthis.destroyHint();\n\t\tthis.destroyRows();\n\t\tthis.factoryMenu.destroy();\n\t}\n\n\treload(parameters: ParameterCollection, parentValues: Object<number, string|string[]>, onlySelfValue: boolean) : void {\n\t\tif (onlySelfValue) {\n\t\t\tthis.replaceParents(parameters);\n\t\t} else {\n\t\t\tthis.redrawParents(parameters, parentValues);\n\t\t}\n\n\t\tthis.redrawParameters(parameters);\n\t\tthis.redrawRequired(parameters);\n\n\t\tthis.parametersRegistry.reset(parameters);\n\t}\n\n\treplaceParents(parameters: ParameterCollection) : void {\n\t\tfor (const row of this.rows.slice()) {\n\t\t\tif (!(row instanceof ParentRow)) { continue; }\n\n\t\t\tconst parameter = parameters.item(row.id);\n\n\t\t\tif (parameter == null) {\n\t\t\t\tthis.delete(row);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst value = row.value();\n\t\t\tconst index = this.rows.indexOf(row);\n\t\t\tthis.delete(row);\n\n\t\t\tconst newRow = this.add(parameter, index + 1);\n\t\t\tnewRow.setValue(value);\n\t\t}\n\t}\n\n\tredrawParents(parameters: ParameterCollection, parentValues: Object<number, string|string[]>) : void {\n\t\tconst found = [];\n\n\t\tfor (const row of this.rows.slice()) {\n\t\t\tif (!(row instanceof ParentRow)) {\n\t\t\t\tif (parentValues[row.id] != null) {\n\t\t\t\t\tthis.delete(row);\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (parentValues[row.id] == null) {\n\t\t\t\tthis.delete(row);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfound.push(row.id);\n\t\t\trow.setValue(parentValues[row.id]);\n\t\t}\n\n\t\tfor (const [id, value] of Object.entries(parentValues)) {\n\t\t\tif (found.indexOf(+id) !== -1) { continue; }\n\n\t\t\tconst parameter = parameters.item(+id) || new UnknownParameter(+id, Array.isArray(value), this.locale);\n\t\t\tconst parent = this.addParent(parameter, 0);\n\n\t\t\tparent.setValue(value);\n\t\t}\n\t}\n\n\taddParent(parameter: Parameter) : ParentRow {\n\t\tconst container = this.el.tBodies[0] || this.el;\n\t\tconst row = ParentRow.make(parameter, this);\n\n\t\tcontainer.insertAdjacentElement('afterbegin', row.el);\n\t\trow.render(parameter, this.values());\n\n\t\tthis.rows.unshift(row);\n\n\t\tthis.el.classList.remove('is--empty');\n\n\t\treturn row;\n\t}\n\n\tredrawParameters(parameters: ParameterCollection) : void {\n\t\tfor (const row of this.rows.slice()) {\n\t\t\tif (!(row instanceof ParameterRow)) { continue; }\n\n\t\t\tconst parameter = parameters.item(row.id);\n\n\t\t\tif (parameter != null) {\n\t\t\t\trow.render(parameter, this.values());\n\t\t\t} else if (row.value()) {\n\t\t\t\trow.markDeprecated();\n\t\t\t} else {\n\t\t\t\tthis.delete(row);\n\t\t\t}\n\t\t}\n\t}\n\n\tredrawRequired(parameters: ParameterCollection) : void {\n\t\tconst exists = this.rows.map((row: Row) : number => row.id);\n\t\tconst filled = this.rows.filter((row: Row) : boolean => !!row.value()).map((row: Row) : number => row.id);\n\n\t\tfor (const parameter of parameters.all()) {\n\t\t\tif (!parameter.showByDefault() || exists.includes(parameter.id()) || !parameter.shownDependsOn(filled)) { continue; }\n\n\t\t\tthis.add(parameter);\n\t\t}\n\t}\n\n\tadd(parameter: Parameter, index: ?number = null) : ParameterRow {\n\t\tconst container = this.el.tBodies[0] || this.el;\n\t\tconst row = ParameterRow.make(parameter, `${this.options.name}[${this.rowsIndex}]`, this);\n\n\t\tif (index != null && this.rows[index] != null) {\n\t\t\tcontainer.insertBefore(row.el, this.rows[index].el);\n\t\t} else {\n\t\t\tindex = null;\n\t\t\tcontainer.appendChild(row.el);\n\t\t}\n\n\t\trow.render(parameter, this.values());\n\n\t\tif (index != null) {\n\t\t\tthis.rows.splice(index, 0, row);\n\t\t} else {\n\t\t\tthis.rows.push(row);\n\t\t}\n\n\t\t++this.rowsIndex;\n\n\t\tthis.el.classList.remove('is--empty');\n\n\t\treturn row;\n\t}\n\n\treflowDepended(id: number): void {\n\t\tthis.parametersRegistry.collection()\n\t\t\t.then((collection: ParameterCollection) => {\n\t\t\t\tfor (const parameter of collection.dependentOf(id)) {\n\t\t\t\t\tconst row = this.row(parameter.id());\n\n\t\t\t\t\tif (row instanceof ParameterRow) {\n\t\t\t\t\t\trow.reflow(this.values());\n\t\t\t\t\t} else if (row == null && parameter.showByDefault()) {\n\t\t\t\t\t\tconst anchor = this.row(id);\n\n\t\t\t\t\t\tif (anchor == null) { continue; }\n\n\t\t\t\t\t\tthis.add(parameter, this.rows.indexOf(anchor) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tbootHint() : void {\n\t\tconst hint = this.el.parentElement.querySelector(this.options.hintElement);\n\n\t\tthis._hint = new BX.CHint({\n\t\t\tparent: hint,\n\t\t\thint: this.locale.message('PARAMETERS_ADD_HINT'),\n\t\t\tshow_timeout: 30,\n\t\t});\n\t}\n\n\tdestroyHint() : void {\n\t\tthis._hint.Destroy();\n\t}\n\n\tbootRows() : void {\n\t\tthis.rows = [];\n\t\tthis.rowsIndex = 0;\n\n\t\tfor (const parentElement of this.el.querySelectorAll(this.options.parentRowElement)) {\n\t\t\tconst row = new ParentRow(parentElement, this);\n\t\t\trow.initial();\n\n\t\t\tthis.rows.push(row);\n\t\t}\n\n\t\tfor (const element of this.el.querySelectorAll(this.options.rowElement)) {\n\t\t\tconst row = new ParameterRow(element, this);\n\t\t\trow.initial();\n\n\t\t\tthis.rows.push(row);\n\t\t\t++this.rowsIndex;\n\t\t}\n\t}\n\n\tdestroyRows() : void {\n\t\tfor (const row of this.rows) {\n\t\t\trow.destroy();\n\t\t}\n\n\t\tthis.rows = [];\n\t}\n\n\tdelete(row: Row) : void {\n\t\tconst index = this.rows.indexOf(row);\n\n\t\tif (index === -1) { throw new Error('unknown item'); }\n\n\t\tconst el = row.el;\n\t\trow.destroy();\n\t\tel.remove();\n\n\t\tthis.rows.splice(index, 1);\n\n\t\tif (this.rows.length === 0) {\n\t\t\tthis.el.classList.add('is--empty');\n\t\t}\n\t}\n\n\tfireChange() : void {\n\t\t$(this.el).trigger('change');\n\t}\n\n\trow(id: number) : ?Row {\n\t\tfor (const row of this.rows) {\n\t\t\tif (row.id === id) {\n\t\t\t\treturn row;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tvalues() : Object {\n\t\tconst result = {};\n\n\t\tfor (const row of this.rows) {\n\t\t\tresult[row.id] = row.value();\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","const BX = window.BX;\n\nexport class Transport {\n\n\tstatic defaults = {\n\t\turl: null,\n\t\tcomponentParameters: {},\n\t}\n\n\t_apiKeyField;\n\n\tconstructor(options: Object) {\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t}\n\n\tconfigure(apiKeyField: ?HTMLInputElement) : void {\n\t\tthis._apiKeyField = apiKeyField;\n\t}\n\n\tfetch(action: string, payload: Object = {}) : Promise {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst formData = {\n\t\t\t\taction: action,\n\t\t\t\tpayload: payload,\n\t\t\t\tcomponentParameters: this.options.componentParameters,\n\t\t\t};\n\n\t\t\tif (this._apiKeyField != null) {\n\t\t\t\tformData['apiKey'] = this._apiKeyField.value;\n\t\t\t}\n\n\t\t\tBX.ajax({\n\t\t\t\turl: this.options.url,\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: formData,\n\t\t\t\tonsuccess: (data) => {\n\t\t\t\t\tif (data.status === 'ok') {\n\t\t\t\t\t\tresolve(data.data);\n\t\t\t\t\t} else if (data.status === 'error') {\n\t\t\t\t\t\treject(new Error(data.message));\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error('unknown response format'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfailure: (data) => {\n\t\t\t\t\treject(new Error(data.message));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}","import {compileTemplate} from \"./utils\";\n\nexport class Locale {\n\n    constructor(messages: Object, language: string) {\n        this._messages = messages;\n\t\tthis._language = language;\n    }\n\n    message(key: string, replaces: Array = null) : string {\n        const message = this._messages[key] || '';\n\n        return compileTemplate(message, replaces);\n    }\n\n\tlanguage() : string {\n\t\treturn this._language;\n\t}\n}","// noinspection JSUnresolvedVariable\nimport type {Transport} from \"./Transport\";\nimport {ParameterCollection} from \"../Parameters/Dto/ParameterCollection\";\nimport type {ParametersPool} from \"../Parameters/ParametersPool\";\n\nconst $ = window.YMarketJQuery ?? window.$;\n\nexport class Form {\n\n\tstatic defaults = {\n\t\ttype: null,\n\t\tpayload: {},\n\t\tfields: {},\n\t\tapiKeyField: null,\n\t\tparentValue: null,\n\t}\n\n\tconstructor(form: ?HTMLFormElement, transport: Transport, parametersPool: ParametersPool, options: Object = {}) {\n\t\tthis.form = form;\n\t\tthis.transport = transport;\n\t\tthis.parametersPool = parametersPool;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t}\n\n\tdestroy() : void {\n\t\tthis.form = null;\n\t}\n\n\thandleChange(dir: boolean, callback: () => {}): void {\n\t\tif (callback == null) { return; }\n\n\t\tfor (const [, selector] of Object.entries(this.options.fields)) {\n\t\t\tif (Array.isArray(selector)) {\n\t\t\t\tthis.handleEvent(dir, callback, selector[0], selector[1], selector[2]);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.handleEvent(dir, callback, selector);\n\t\t}\n\t}\n\n\thandleEvent(dir: boolean, callback: () => {}, selector: string, childSelector: ?string, eventName: ?string) : void {\n\t\tconst element = this.form.querySelector(this.cssSelector(selector));\n\n\t\tif (element == null) { return; }\n\n\t\tif (eventName === 'onLookupInputChange') {\n\t\t\t// noinspection JSUnresolvedReference\n\t\t\twindow.jsUtils[dir ? 'addCustomEvent' : 'removeCustomEvent']('onLookupInputChange', this.onLookupInputChange.bind(this, callback, element.id));\n\t\t\treturn;\n\t\t}\n\n\t\tif (eventName == null) { eventName = 'change'; }\n\n\t\tif (childSelector != null) {\n\t\t\t$(element)[dir ? 'on' : 'off'](eventName, this.cssSelector(childSelector), callback);\n\t\t\treturn;\n\t\t}\n\n\t\telement[dir ? 'addEventListener' : 'removeEventListener'](eventName, callback);\n\t}\n\n\tonLookupInputChange(callback: () => {}, layoutId: string, params: Object, data: Object) : void {\n\t\t// noinspection JSUnresolvedReference\n\t\tif (data.ACTION === 'add' && layoutId === `layout_${data.CONTROL_ID}`) {\n\t\t\tcallback();\n\t\t}\n\t}\n\n\treload(category: string) : Promise<Object> {\n\t\tif (this.options.parentValue != null) {\n\t\t\tconst parentValue = this.options.parentValue() || {};\n\n\t\t\treturn this.parametersPool.get(category || parentValue.category)\n\t\t\t\t.then((parametersCollection) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tparameters: parametersCollection,\n\t\t\t\t\t\tparentCategory: parentValue.category || '',\n\t\t\t\t\t\tparentParameters: parentValue.parameters || {},\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t}\n\n\t\treturn this.transport.fetch('reload', {\n\t\t\tcategory: category,\n\t\t\tform: this.transportPayload(),\n\t\t})\n\t\t\t.then((data: Object) : void => {\n\t\t\t\tdata.parameters = new ParameterCollection(data.parameters || []);\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\n\ttransportPayload() : Object {\n\t\treturn {\n\t\t\ttype: this.options.type,\n\t\t\tpayload: this.options.payload,\n\t\t\tfields: this.values(),\n\t\t};\n\t}\n\n\tvalues() {\n\t\tconst result = {};\n\n\t\tfor (const [key, elements] of Object.entries(this.fields())) {\n\t\t\tresult[key] = this.value(elements);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tvalue(input: HTMLInputElement|HTMLSelectElement) {\n\t\tif (!input.multiple) { return input.value; }\n\n\t\treturn Array.from(input.querySelectorAll('option'))\n\t\t\t.filter((option) => option.selected)\n\t\t\t.map((option) => option.value);\n\t}\n\n\tfields() : Object<string, HTMLInputElement|HTMLSelectElement> {\n\t\tif (!this.options.fields) { return {}; }\n\n\t\tconst result = {};\n\n\t\tfor (const [name, selector] of Object.entries(this.options.fields)) {\n\t\t\tconst input = this.field(selector);\n\n\t\t\tif (input == null) { continue; }\n\n\t\t\tresult[name] = input;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfield(selector: string|string[]|null) : ?HTMLInputElement|HTMLSelectElement {\n\t\tif (selector === null || this.form == null) { return null; }\n\n\t\tif (Array.isArray(selector)) {\n\t\t\tconst container = this.form.querySelector(this.cssSelector(selector[0]));\n\n\t\t\tif (container == null) { return null; }\n\n\t\t\treturn container.querySelector(this.cssSelector(selector[1]));\n\t\t}\n\n\t\treturn this.form.querySelector(this.cssSelector(selector));\n\t}\n\n\tapiKeyField() : ?HTMLInputElement {\n\t\treturn this.field(this.options.apiKeyField);\n\t}\n\n\tcssSelector(selector: string) : string {\n\t\tif (/^(input|select|textarea|div|#|\\.)/.test(selector)) {\n\t\t\treturn selector;\n\t\t}\n\n\t\treturn `[name=\"${selector}\"]`;\n\t}\n}","import {compileTemplate} from \"./utils\";\nimport type {Locale} from \"./Locale\";\n\nexport class State {\n\n\tstatic defaults = {\n\t\tloadingTemplate: '#LOADING#...',\n\t\twaitingTemplate: '',\n\t\terrorTemplate: '#MESSAGE#',\n\t};\n\n\tlocale: Locale;\n\n\tconstructor(element: HTMLElement, locale: Locale, options: Object = {}) {\n\t\tthis.el = element;\n\t\tthis.locale = locale;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t}\n\n\tloading() : void {\n\t\tthis.state('loading', {\n\t\t\tLOADING: this.locale.message('LOADING'),\n\t\t});\n\t}\n\n\twaiting() : void {\n\t\tthis.state('waiting');\n\t}\n\n\terror(reason: Error) : void {\n\t\tthis.state('error', {\n\t\t\tMESSAGE: reason.message,\n\t\t});\n\t}\n\n\tstate(type: string, vars: Object = {}) : void {\n\t\tconst html = this.compileTemplate(type, vars);\n\n\t\tthis.markTypeClass(type);\n\t\tthis.replaceHtml(html);\n\t}\n\n\tcompileTemplate(type: string, vars: Object = {}) : string {\n\t\tconst template = this.options[type + 'Template'];\n\n\t\treturn compileTemplate(template, vars);\n\t}\n\n\tmarkTypeClass(type: string) : void {\n\t\tconst states = [\n\t\t\t'loading',\n\t\t\t'waiting',\n\t\t\t'error',\n\t\t];\n\n\t\tfor (const state of states) {\n\t\t\tif (state === type) {\n\t\t\t\tthis.el.classList.add(`is--${state}`);\n\t\t\t} else {\n\t\t\t\tthis.el.classList.remove(`is--${state}`);\n\t\t\t}\n\t\t}\n\t}\n\n\treplaceHtml(html: string) : void {\n\t\tthis.el.innerHTML = html;\n\t}\n}","import type {Transport} from \"../Component/Transport\";\nimport {ParameterCollection} from \"./Dto/ParameterCollection\";\n\nexport class ParametersPool {\n\n\t_pool = {};\n\t_fetch = {};\n\ttransport: Transport;\n\n\tconstructor(transport: Transport) {\n\t\tthis.transport = transport;\n\t}\n\n\tset(category: string, parameterCollection: ParameterCollection) : void {\n\t\tcategory && (this._pool[category] = parameterCollection);\n\t}\n\n\tget(category: string) : Promise<ParameterCollection> {\n\t\tif (!category) {\n\t\t\treturn Promise.resolve(new ParameterCollection([]));\n\t\t}\n\n\t\tif (this._pool[category] != null) {\n\t\t\treturn Promise.resolve(this._pool[category]);\n\t\t}\n\n\t\tif (this._fetch[category] != null) {\n\t\t\treturn this._fetch[category];\n\t\t}\n\n\t\tthis._fetch[category] = this.transport.fetch('parameters', { category: category })\n\t\t\t.then((data) => {\n\t\t\t\tconst collection = new ParameterCollection(data.parameters);\n\n\t\t\t\tthis._pool[category] = collection;\n\t\t\t\tthis._fetch[category] = null;\n\n\t\t\t\treturn collection;\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tthis._fetch[category] = null;\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\treturn this._fetch[category];\n\t}\n\n}","import {CategoryField} from \"./CategoryField\";\nimport {ParametersField} from \"./ParametersField\";\nimport {Transport} from \"./Component/Transport\";\nimport {Locale} from \"./Component/Locale\";\nimport {Form} from \"./Component/Form\";\nimport {State} from \"./Component/State\";\nimport {ParametersRegistry} from \"./Parameters/ParametersRegistry\";\nimport {ParametersPool} from \"./Parameters/ParametersPool\";\n\n// noinspection JSUnusedGlobalSymbols\nexport class CategoryPanel {\n\n    static defaults = {\n        transport: null,\n\t    language: 'ru',\n\t    locale: null,\n\t    form: null,\n\t    category: null,\n        categoryElement: '[data-entity=\"category\"]',\n\t    parameters: null,\n        parametersElement: '[data-entity=\"parameters\"]',\n\t    parametersPool: null,\n\t    stateElement: '[data-entity=\"state\"]',\n    }\n\n\t_reloadTimeout;\n\n\tconstructor(element: HTMLElement, options: Object = {}) {\n\t\tthis.el = element;\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t\tthis.locale = new Locale(this.options.locale, this.options.language);\n\t\tthis.transport = new Transport(this.options.transport);\n\t\tthis.parametersPool = this.options.parametersPool != null ? this.options.parametersPool : new ParametersPool(this.transport);\n\t\tthis.form = new Form(this.el.closest('form'), this.transport, this.parametersPool, this.formOptions());\n\t\tthis.state = new State(element.querySelector(this.options.stateElement), this.locale);\n\t\tthis.category = new CategoryField(element.querySelector(this.options.categoryElement), this.transport, this.locale, this.options.category);\n\t\tthis.parameters = new ParametersField(\n\t\t\telement.querySelector(this.options.parametersElement),\n\t\t\tnew ParametersRegistry(this.category, this.parametersPool, this.state, this.locale),\n\t\t\tthis.state,\n\t\t\tthis.locale,\n\t\t\tthis.parametersOptions(this.category)\n\t\t);\n\n\t\tthis.transport.configure(this.form.apiKeyField());\n\t\tthis.category.handleChange(true, this.onCategoryChange);\n\t\tthis.form.handleChange(true, this.onFormChange);\n\t}\n\n\tdestroy() : void {\n\t\tclearTimeout(this._reloadTimeout);\n\t\tthis.category.handleChange(false, this.onCategoryChange);\n\t\tthis.form.handleChange(false, this.onFormChange);\n\n\t\tthis.parameters.destroy();\n\t\tthis.category.destroy();\n\t\tthis.form.destroy();\n\t}\n\n\tformOptions() : Object {\n\t\tconst options = Object.assign({}, this.options.form);\n\n\t\tif (this.el.dataset.formPayload != null) {\n\t\t\toptions['payload'] = JSON.parse(this.el.dataset.formPayload);\n\t\t}\n\n\t\treturn options;\n\t}\n\n\tparametersOptions(category: CategoryField) : Object {\n\t\tconst options = Object.assign({}, this.options.parameters);\n\n\t\tif (options.name == null) {\n\t\t\toptions.name = category.selectElement().prop('name').replace(/\\[CATEGORY]$/, '[PARAMETERS]');\n\t\t}\n\n\t\treturn options;\n\t}\n\n\tonCategoryChange = () : void => {\n\t\tthis.reload();\n\t}\n\n\tonFormChange = () : void => {\n\t\tthis.reloadDelayed();\n\t}\n\n\treloadDelayed() : void {\n\t\tclearTimeout(this._reloadTimeout);\n\n\t\t// noinspection JSUnresolvedReference\n\t\tif (window.JCIBlockGroupFieldIsRunning) { return; }\n\n\t\tthis._reloadTimeout = setTimeout(() => this.reload(), 200);\n\t}\n\n\treload() {\n\t\tclearTimeout(this._reloadTimeout);\n\t\tthis.state.loading();\n\n\t\tconst category = this.category.value();\n\n\t\tthis.form.reload(category)\n\t\t\t.then((data: Object) : void => {\n\t\t\t\tthis.category.resetParent(data.parentCategory);\n\t\t\t\tthis.parameters.reload(data.parameters, data.parentParameters, !!category);\n\t\t\t\tthis.state.waiting();\n\t\t\t})\n\t\t\t.catch((error: Error) : void => {\n\t\t\t\tthis.state.error(error);\n\t\t\t});\n\t}\n\n\tvalue() : Object {\n\t\treturn {\n\t\t\tcategory: this.category.value(),\n\t\t\tparameters: this.parameters.values(),\n\t\t};\n\t}\n\n\tresetParent(parentValue: Object) : void {\n\t\tthis.category.resetParent(parentValue.category);\n\n\t\tif (this.category.value()) { return; }\n\n\t\tthis.parametersPool.get(parentValue.category)\n\t\t\t.then((parameterCollection) => {\n\t\t\t\tthis.parameters.reload(parameterCollection, parentValue.parameters, false);\n\t\t\t});\n\t}\n}","import {CategoryPanel} from \"./CategoryPanel\";\n\nconst BX = window.BX;\n\n// noinspection JSUnusedGlobalSymbols\nexport class CategoryFactory {\n\tstatic READY_TOKEN = 'ym-category--ready';\n\n\tconstructor(className: string, options: Object = {}) {\n\t\tthis.className = className;\n\t\tthis.options = options;\n\t\tthis.instances = [];\n\n\t\tthis.boot();\n\t\tthis.bind();\n\t}\n\n\tboot() : void {\n\t\tfor (const element of document.getElementsByClassName(this.className)) {\n\t\t\tif (element.classList.contains(CategoryFactory.READY_TOKEN)) { continue; }\n\n\t\t\tthis.instances.push(new CategoryPanel(element, this.options));\n\n\t\t\telement.classList.add(CategoryFactory.READY_TOKEN);\n\t\t}\n\t}\n\n\tbind() : void {\n\t\t// noinspection JSUnresolvedReference\n\t\tBX.addCustomEvent('onAdminTabsChange', () => this.check());\n\t\tBX.addCustomEvent('Grid::updated', () => this.check());\n\t\tBX.addCustomEvent('Grid::noEditedRows', () => this.check());\n\t}\n\n\tcheck() : void {\n\t\tfor (const instance of this.instances.slice()) {\n\t\t\tif (document.contains(instance.el)) { continue; }\n\n\t\t\tinstance.destroy();\n\t\t\tthis.instances.splice(this.instances.indexOf(instance), 1);\n\t\t}\n\t}\n}"],"names":["$","window","YMarketJQuery","jQuery","CategoryField","constructor","element","transport","locale","options","_bindSearchPaste","onCopyClick","copyClipboard","this","value","parentValue","onSelectOpen","handleSearchPaste","onSelectClosing","onSearchPaste","e","paste","originalEvent","clipboardData","getData","toString","lines","split","map","line","trim","filter","indexOf","length","target","join","preventDefault","trigger","ajaxTransport","params","success","failure","test","data","q","fetch","query","language","then","prepareResults","catch","error","_lastError","message","templateSelection","variant","id","text","$el","el","Object","assign","defaults","bind","bootSelect","destroy","unbind","destroySelect","handleSelectOpen","handleSelectClose","handleCopy","handleChange","dir","callback","selectElement","find","copyElement","select2","width","minimumInputLength","selectOnClose","allowClear","ajax","cache","delay","getLanguageOptions","placeholder","languageDefaults","errorLoading","fn","amd","require","console","variants","results","fake","css","position","left","top","insertAfter","val","select","execCommand","remove","command","document","err","log","resetParent","category","parentElement","attr","BX","Row","field","onParameterWait","parameter","render","values","onHintEnter","_hintHover","initialLoad","handleHintHover","_hint","Show","onHintLeave","dataset","parametersRegistry","stopWait","control","initial","initialControl","wait","Error","setHint","description","setRequired","required","renderControl","name","replace","focused","parameterControl","setValue","focus","hint","querySelector","hintElement","Destroy","classList","add","CHint","parent","show_timeout","CONTENT","setContent","HINT","fieldElement","valueElement","Control","boot","activeElement","SelectSkeleton","tags","allowedCustom","multiple","selected","option","querySelectorAll","push","_toArray","found","first","changed","matched","selectedItem","createElement","textContent","appendChild","placeholderSelected","triggerHandler","Array","isArray","InitialControl","unbindFocus","bindFocus","_focusCallback","on","off","compileTemplate","template","variables","result","key","entries","marker","previousPosition","htmlToElement","html","tag","renderer","innerHTML","firstElementChild","TextControl","maxLength","EnumControl","unbindChange","allowCustom","bindChange","_changeCallback","reflow","selfSelected","existOptions","disabled","existIndex","selectedFound","_activeValues","matchedOption","existOption","includes","anchor","insertBefore","optionSelected","restricted","_restricted","restrictedValues","restrictions","valueRestrictions","restriction","limitingId","siblingValue","_castOptionIds","limitedValue","newRestricted","item","idMatches","exec","BooleanControl","NumberControl","_onInput","parseFloat","valid","Number","isNaN","min","max","_markInvalid","_onChange","minValue","maxValue","_handleInput","ParameterRow","unit","defaultUnit","onChange","reflowDepended","onDelete","delete","fireChange","handleDelete","deleteElement","setDeprecated","type","make","markDeprecated","deprecated","FactoryMenu","_opening","onClick","evt","isOpen","collection","parameterCollection","open","state","_menu","CMenu","handleClick","DIV","style","display","toLowerCase","count","setItems","menuItems","exists","rows","row","filled","parameters","availableParameters","TEXT","HTML","ONCLICK","all","shownDependsOn","Parameter","fields","_this$fields$constrai","_this$fields$constrai2","_this$fields$constrai3","showByDefault","GROUP_ID","dependsOn","ids","ParameterCollection","property","dependentOf","other","ParametersRegistry","parametersPool","_itemWaiting","_parameters","Promise","resolve","loaded","reset","resolveWaiting","resolveFetch","index","keys","waitingId","waitingCallback","splice","resolveWaitingItem","_parametersPromise","reject","_parametersResolve","loading","get","waiting","ParentControl","ParentRow","UnknownParameter","multivalue","title","ParametersField","factoryMenu","addElement","bootHint","bootRows","destroyHint","destroyRows","reload","parentValues","onlySelfValue","replaceParents","redrawParents","redrawParameters","redrawRequired","slice","addParent","container","tBodies","insertAdjacentElement","unshift","rowsIndex","parentRowElement","rowElement","Transport","configure","apiKeyField","_apiKeyField","action","payload","formData","componentParameters","url","method","dataType","onsuccess","status","onfailure","Locale","messages","_messages","_language","replaces","Form","form","selector","handleEvent","childSelector","eventName","cssSelector","jsUtils","onLookupInputChange","layoutId","ACTION","CONTROL_ID","parametersCollection","parentCategory","parentParameters","transportPayload","elements","input","from","State","LOADING","reason","MESSAGE","vars","markTypeClass","replaceHtml","states","loadingTemplate","waitingTemplate","errorTemplate","ParametersPool","_pool","_fetch","set","CategoryPanel","onCategoryChange","onFormChange","reloadDelayed","closest","formOptions","stateElement","categoryElement","parametersElement","parametersOptions","clearTimeout","_reloadTimeout","formPayload","JSON","parse","prop","JCIBlockGroupFieldIsRunning","setTimeout","CategoryFactory","className","instances","getElementsByClassName","contains","READY_TOKEN","addCustomEvent","check","instance"],"mappings":"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"}