{"version":3,"file":"bundle.js","sources":["src/View/Glossary.js","src/View/MessagePopup.js","src/View/View.js","src/View/OfferGrid.js","src/Hint/Hint.js","src/Hint/AdminHint.js","src/Hint/PopupHint.js","src/Hint/HintFactory.js","src/View/SummaryRow.js","src/View/FailView.js","src/SkuStatus.js","src/Component/Repository.js","src/Component/Locale.js","src/SkuStatusFactory.js"],"sourcesContent":["import type {Locale} from \"../Component/Locale\";\n\nexport class Glossary {\n\n\tstatic rating(rating: ?number, locale: Locale) : string {\n\t\treturn `<span class=\"ym-sku-status-rating level--${this.ratingLevel(rating)}\">\n\t\t\t${rating != null ? `${rating} ${locale.message('RATING_SUFFIX')}` : '&mdash;'}\n\t\t</span>`;\n\t}\n\n\tstatic ratingLevel(rating: ?number): string {\n\t\tif (rating == null) {\n\t\t\treturn 'unknown';\n\t\t}\n\n\t\tif (rating >= 80) {\n\t\t\treturn 'good';\n\t\t}\n\n\t\tif (rating >= 40) {\n\t\t\treturn 'warning';\n\t\t}\n\n\t\treturn 'error';\n\t}\n\n}","const BX = window.BX;\n\nexport class MessagePopup {\n\n\tconstructor(messages: Object, locale: Locale) {\n\t\tthis.messages = messages;\n\t\tthis.locale = locale;\n\t}\n\n\tshow() {\n\t\tconst popup = new BX.CAdminDialog({\n\t\t\tcontent: this.content(),\n\t\t\twidth: 800,\n\t\t\theight: 500,\n\t\t});\n\n\t\tpopup.Show();\n\t}\n\n\tcontent() : string {\n\t\treturn Object.entries(this.messages).map(([type, group]) => `\n\t\t\t<div class=\"ym-sku-status-messages-group\">${this.locale.message(type.toUpperCase())}</div>\n\t\t\t<ul class=\"ym-sku-status-messages\">\n\t\t\t\t${group.map((message) => `<li class=\"ym-sku-status-message\">\n\t\t\t\t\t${message['message'] ? `<div class=\"ym-sku-status-message__title\">${message['message']}</div>` : ''}\n\t\t\t\t\t${message['comment'] ? `<div class=\"ym-sku-status-message__comment\">${message['comment']}</div>` : ''}\n\t\t\t\t</li>`).join('')}\n\t\t\t</ul>\n\t\t`).join('');\n\t}\n\n}","export class View {\n\n\tmount(viewport: HTMLElement) : void {}\n\n\tunmount(viewport: HTMLElement) : void {}\n\n}\n","import {Glossary} from \"./Glossary\";\nimport {MessagePopup} from \"./MessagePopup\";\nimport {View} from \"./View\";\nimport type {Locale} from \"../Component/Locale\";\n\nconst BX = window.BX;\n\nexport class OfferGrid extends View {\n\n\tconstructor(businesses: Array, elementStatus: Object, locale: Locale, insideHint: boolean) {\n\t\tsuper();\n\t\tthis.elementStatus = elementStatus;\n\t\tthis.businesses = businesses;\n\t\tthis.locale = locale;\n\t\tthis.insideHint = insideHint;\n\t}\n\n\thandlePopupClick(viewport: HTMLElement, dir: boolean) : void {\n\t\tfor (const link of viewport.querySelectorAll('[data-action=\"popup\"]')) {\n\t\t\tlink[dir ? 'addEventListener' : 'removeEventListener']('click', this.onPopupClick);\n\t\t}\n\t}\n\n\thandleSiblingsClick(viewport: HTMLElement, dir: boolean) : void {\n\t\tfor (const link of viewport.querySelectorAll('[data-action=\"siblings\"]')) {\n\t\t\tlink[dir ? 'addEventListener' : 'removeEventListener']('click', this.onSiblingsClick);\n\t\t}\n\t}\n\n\tonPopupClick = (evt: Event) : void => {\n\t\tconst link = evt.currentTarget;\n\t\tconst offer = this.offer(+link.dataset.business, +link.dataset.offer);\n\n\t\t(new MessagePopup(offer['messages'], this.locale)).show();\n\n\t\tevt.preventDefault();\n\t}\n\n\tonSiblingsClick = (evt: Event) : void => {\n\t\tconst link = evt.currentTarget;\n\t\tconst parent = link.parentElement;\n\t\tconst title = link.getAttribute('title');\n\n\t\tlink.remove();\n\t\tparent.textContent = parent.textContent.trim() + ', ' + title;\n\n\t\tevt.preventDefault();\n\t}\n\n\tmount(viewport: HTMLElement) : void {\n\t\tviewport.innerHTML = this.render();\n\n\t\tthis.handlePopupClick(viewport, true);\n\t\tthis.handleSiblingsClick(viewport, true);\n\t}\n\n\tunmount(viewport: HTMLElement) : void {\n\t\tthis.handlePopupClick(viewport, false);\n\t\tthis.handleSiblingsClick(viewport, false);\n\t}\n\n\trender() : string {\n\t\tconst partials = [];\n\n\t\tfor (const business of this.businesses) {\n\t\t\tif (this.elementStatus['businesses'][business['id']] == null) { continue; }\n\n\t\t\tconst businessStatus = this.elementStatus['businesses'][business['id']];\n\t\t\tlet html = '';\n\n\t\t\tif (this.businesses.length > 1) {\n\t\t\t\thtml += `<div class=\"ym-sku-status-business\">\n\t                <div class=\"ym-sku-status-business__title\">${business.name}</div>\n\t                ${this.locale.message('RATING_TITLE')}: ${Glossary.rating(businessStatus['rating'], this.locale)}\n\t            </div>`;\n\t\t\t} else if (!this.insideHint) {\n\t\t\t\thtml += `<div class=\"ym-sku-status-business\">\n\t                ${this.locale.message('RATING_TITLE')}: ${Glossary.rating(businessStatus['rating'], this.locale)}\n\t\t\t\t</div>`;\n\t\t\t}\n\n\t\t\tif (businessStatus.error != null) {\n\t\t\t\thtml += `<div class=\"errortext\">${businessStatus.error}</div>`;\n\t\t\t} else {\n\t\t\t\thtml += this.renderOffers(business, businessStatus);\n\t\t\t}\n\n\t\t\tpartials.push(html);\n\t\t}\n\n\t\tif (partials.length === 0) {\n\t\t\treturn this.insideHint\n\t\t\t\t? this.locale.message('UNPLACED')\n\t\t\t\t: `${this.locale.message('RATING_TITLE')}: ${this.locale.message('UNPLACED')}`;\n\t\t}\n\n\t\treturn partials.join('');\n\t}\n\n\trenderOffers(business: Object, businessStatus: Object): string {\n\t\tconst showLimit = 5;\n\t\tconst offersHtml = businessStatus['offers'].map((offer) => `<div class=\"ym-sku-status-offer\">\n\t\t\t<div class=\"ym-sku-status-offer__title\">\n\t\t\t\t${this.offerName(offer)}\n\t\t\t\t${this.offerSiblings(offer)}\n\t\t\t</div>\n\t\t\t${offer.caption != null ? `\n\t\t\t\t${offer.caption.text}<br />\n\t\t\t\t${offer.caption.more ? `${offer.caption.more}<br />` : ''}\n\t\t\t\t<a class=\"ym-sku-status-offer__more\" href=\"#\" data-business=\"${business['id']}\" data-offer=\"${offer['id']}\" data-action=\"popup\">${this.locale.message('DETAILS')}</a>\n\t\t\t` : ''}\n\t\t</div>`);\n\n\t\tif (offersHtml.length <= showLimit) {\n\t\t\treturn offersHtml.join('');\n\t\t}\n\n\t\tconst commonOffersHtml = offersHtml.slice(0, showLimit);\n\t\tconst additionalOffersHtml = offersHtml.slice(showLimit);\n\n\t\treturn `\n\t\t\t${commonOffersHtml.join('')}\n\t\t\t<details class=\"ym-sku-status-offers-additional\">\n\t\t\t\t<summary>${this.locale.message('MORE')} ${additionalOffersHtml.length}</summary>\n\t\t\t\t${additionalOffersHtml.join('')}\n\t\t\t</details>\n\t\t`;\n\t}\n\n\tofferSiblings(offer: Object) : string {\n\t\tconst siblings = offer['siblings'];\n\n\t\tif (siblings == null) { return ''; }\n\n\t\tconst names = siblings.map((offer) => this.offerName(offer)).join(', ');\n\n\t\t// noinspection JSUnresolvedReference\n\t\treturn `<a class=\"ym-sku-status-offer__siblings\" href=\"#\" title=\"${BX.util.htmlspecialchars(names)}\" data-action=\"siblings\">\n\t\t\t${this.locale.message('MORE')} ${siblings.length}\n\t\t</a>`;\n\t}\n\n\tofferName(offer: Object) : string {\n\t\treturn `${offer['name']} [${offer['sku']}]`;\n\t}\n\n\toffer(businessId: number, offerId: number) : Object {\n\t\tfor (const business of this.businesses) {\n\t\t\tif (business['id'] !== businessId) { continue; }\n\n\t\t\tfor (const offer of this.elementStatus['businesses'][business['id']]['offers']) {\n\t\t\t\tif (offer['id'] !== offerId) { continue; }\n\n\t\t\t\treturn offer;\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(`offer ${offerId} for business ${businessId} not found`);\n\t}\n\n}","export class Hint {\n\n\tdestroy() : void {}\n\n\tcontainer() : HTMLElement {}\n\n\tshow() : void {}\n\n\tshowNow() : void {}\n}","import {Hint} from \"./Hint\";\n\nconst BX = window.BX;\n\nexport class AdminHint extends Hint {\n\n\tdefaults = {\n\t\tshowTimeout: 200,\n\t\thideTimeout: 200\n\t};\n\n\tconstructor(anchor: HTMLElement) {\n\t\tsuper();\n\n\t\tthis.hint = new BX.CHint({\n\t\t\tparent: anchor,\n\t\t\thint: 'holder',\n\t\t\tshow_timeout: this.defaults.showTimeout,\n\t\t\thide_timeout: this.defaults.hideTimeout,\n\t\t});\n\t\tthis.hint.Init();\n\t}\n\n\tdestroy() : void {\n\t\tthis.hint.Destroy();\n\t}\n\n\tcontainer() : HTMLElement {\n\t\treturn this.hint.CONTENT_TEXT;\n\t}\n\n\tshow() : void {\n\t\tthis.hint.Show();\n\t}\n\n\tshowNow() : void {\n\t\tconst originalTimeout = this.hint.PARAMS.show_timeout;\n\n\t\tthis.hint.PARAMS.show_timeout = 0;\n\t\tthis.hint.Show();\n\t\tthis.hint.PARAMS.show_timeout = originalTimeout;\n\t}\n\n}","import {Hint} from \"./Hint\";\n\nconst BX = window.BX;\n\nexport class PopupHint extends Hint {\n\n\tconstructor(anchor: HTMLElement) {\n\t\tsuper();\n\n\t\tthis.hint = new BX.PopupWindow({\n\t\t\tautoHide: true,\n\t\t\tdraggable: false,\n\t\t\tcloseByEsc: true,\n\t\t\tbindElement: anchor,\n\t\t\tcontent: 'holder',\n\t\t\tmaxWidth: 500,\n\t\t\tangleLeftOffset: 20,\n\t\t\tangle: {\n\t\t\t\tposition: 'top',\n\t\t\t\toffset: 20 + this.angleOffset(anchor),\n\t\t\t},\n\t\t});\n\t}\n\n\tangleOffset(anchor: HTMLElement) : number {\n\t\tconst rating = anchor.querySelector('.ym-sku-status-rating');\n\t\tconst defaultOffset = 15;\n\n\t\tif (rating == null) { return defaultOffset; }\n\n\t\tconst ratingRect = rating.getBoundingClientRect();\n\t\tconst anchorRect = anchor.getBoundingClientRect();\n\n\t\treturn ratingRect.left - anchorRect.left + ((ratingRect.width || 0) / 2);\n\t}\n\n\tdestroy() : void {\n\t\tthis.hint.destroy();\n\t}\n\n\tcontainer() : HTMLElement {\n\t\treturn this.hint.contentContainer;\n\t}\n\n\tshow() : void {\n\t\tthis.hint.show();\n\t}\n\n\tshowNow() : void {\n\t\tthis.hint.show();\n\t}\n\n}","import {Hint} from \"./Hint\";\nimport {AdminHint} from \"./AdminHint\";\nimport {PopupHint} from \"./PopupHint\";\n\nexport class HintFactory {\n\n\tstatic create(anchor: HTMLElement, admin: boolean) : Hint {\n\t\treturn admin ? new AdminHint(anchor) : new PopupHint(anchor);\n\t}\n\n}","import {Glossary} from \"./Glossary\";\nimport {OfferGrid} from \"./OfferGrid\";\nimport {View} from \"./View\";\nimport type {Hint} from \"../Hint/Hint\";\nimport {HintFactory} from \"../Hint/HintFactory\";\n\nexport class SummaryRow extends View {\n\n\tviewport: HTMLElement;\n\thint: ?Hint;\n\tadmin: boolean;\n\n\tdefaults = {\n\t\tshowTimeout: 200,\n\t\thideTimeout: 200\n\t};\n\n\tconstructor(businesses: Array, elementStatus: Object, locale: Locale, admin: boolean) {\n\t\tsuper();\n\n\t\tthis.elementStatus = elementStatus;\n\t\tthis.businesses = businesses;\n\t\tthis.locale = locale;\n\t\tthis.offerGrid = new OfferGrid(businesses, elementStatus, locale, true);\n\t\tthis.admin = admin;\n\t}\n\n\thandleClick(viewport: HTMLElement, dir: boolean) : void {\n\t\tviewport[dir ? 'addEventListener' : 'removeEventListener']('click', this.onClick);\n\t}\n\n\thandleMouseOver(viewport: HTMLElement, dir: boolean) : void {\n\t\tif (!this.admin) { return; }\n\n\t\tviewport[dir ? 'addEventListener' : 'removeEventListener']('mouseover', this.onMouseOver);\n\t}\n\n\tonClick = (evt: Event) : void => {\n\t\tthis.handleMouseOver(evt.currentTarget, false);\n\t\tthis.bootHint(evt.currentTarget).showNow();\n\t}\n\n\tonMouseOver = (evt) : void => {\n\t\tthis.handleMouseOver(evt.currentTarget, false);\n\t\tthis.bootHint(evt.currentTarget).show();\n\t}\n\n\tmount(viewport: HTMLElement) : void {\n\t\tviewport.innerHTML = `${this.locale.message('RATING_TITLE')}: ${Glossary.rating(this.elementStatus['rating'], this.locale)}`;\n\n\t\tthis.handleClick(viewport, true);\n\t\tthis.handleMouseOver(viewport, true);\n\t}\n\n\tunmount(viewport: HTMLElement) : void {\n\t\tthis.handleMouseOver(viewport, false);\n\t\tthis.handleClick(viewport, false);\n\t\tthis.destroyHint();\n\t}\n\n\tbootHint(anchor: HTMLElement) : Hint {\n\t\tif (this.hint != null) { return this.hint; }\n\n\t\tthis.hint = HintFactory.create(anchor, this.admin);\n\t\tthis.offerGrid.mount(this.hint.container());\n\n\t\treturn this.hint;\n\t}\n\n\tdestroyHint() : void {\n\t\tif (this.hint == null) { return; }\n\n\t\tthis.offerGrid.unmount(this.hint.container());\n\t\tthis.hint.destroy();\n\t\tthis.hint = null;\n\t}\n\n}","import {View} from \"./View\";\n\nexport class FailView extends View {\n\n\tconstructor(error: Error, locale: Locale) {\n\t\tsuper();\n\t\tthis.error = error;\n\t\tthis.locale = locale;\n\t}\n\n\tmount(viewport: HTMLElement) {\n\t\tconst loader = viewport.querySelector('.ym-sku-status-loader');\n\t\tconst html = `<div class=\"errortext\">${this.error.message || this.locale.message('UNKNOWN_ERROR')}</div>`;\n\n\t\tif (loader != null) {\n\t\t\tloader.outerHTML = html;\n\t\t} else {\n\t\t\tviewport.innerHTML = html;\n\t\t}\n\t}\n\n}","import type {Repository} from \"./Component/Repository\";\nimport type {Locale} from \"./Component/Locale\";\nimport type {View} from \"./View/View\";\nimport {SummaryRow} from \"./View/SummaryRow\";\nimport {OfferGrid} from \"./View/OfferGrid\";\nimport {FailView} from \"./View/FailView\";\n\nexport class SkuStatus {\n\n\tstatic defaults = {\n\t\tid: null,\n\t\ttheme: null,\n\t\tadmin: false,\n\t};\n\n\tdestroyed: boolean = false;\n\n\tconstructor(element: HTMLElement, transport: Repository, locale: Locale, options = {}) {\n\t\tthis.el = element;\n\t\tthis.transport = transport;\n\t\tthis.locale = locale;\n\t\tthis.options = Object.assign({}, SkuStatus.defaults, options);\n\t}\n\n\tdestroy() : void {\n\t\tthis.destroyed = true;\n\t\tthis.transport = null;\n\t\tthis.locale = null;\n\n\t\tthis.destroyView();\n\t}\n\n\tid() : number {\n\t\treturn this.options.id;\n\t}\n\n\tload() : void {\n\t\tthis.loading();\n\n\t\tthis.transport.load(this.options.id)\n\t\t\t.then(this.render.bind(this))\n\t\t\t.catch(this.fail.bind(this));\n\t}\n\n\twaitLoad(promise: Promise) : void {\n\t\tpromise\n\t\t\t.then(this.render.bind(this))\n\t\t\t.catch(this.fail.bind(this));\n\t}\n\n\tloading() : void {\n\t\tconst loader = this.el.querySelector('.ym-sku-status-loader');\n\n\t\tif (loader == null) { return; }\n\n\t\tloader.classList.add('is--active');\n\t}\n\n\trender(response: Object) : void {\n\t\tconst elementStatus = response.element;\n\t\tconst businesses = response.businesses;\n\n\t\tif (this.destroyed) { return; }\n\n\t\tthis.draw(\n\t\t\tthis.options.theme === 'grid'\n\t\t\t\t? new SummaryRow(businesses, elementStatus, this.locale, this.options.admin)\n\t\t\t\t: new OfferGrid(businesses, elementStatus, this.locale)\n\t\t);\n\t}\n\n\tfail(error: Error) : void {\n\t\tif (this.destroyed) { return; }\n\n\t\tthis.draw(new FailView(error, this.locale));\n\t}\n\n\tdraw(view: View) : void {\n\t\tthis.destroyView();\n\n\t\tthis._view = view;\n\t\tview.mount(this.el);\n\t}\n\n\tdestroyView() : void {\n\t\tif (this._view == null) { return; }\n\n\t\tthis._view.unmount(this.el);\n\t\tthis._view = null;\n\t}\n}\n","import type {SkuStatusFactory} from \"../SkuStatusFactory\";\nimport type {Locale} from \"./Locale\";\n\nexport class Repository {\n\n\tstatic defaults = {\n\t\turl: null,\n\t\tlimit: null,\n\t\tdelay: 1000,\n\t\tpayload: {},\n\t};\n\n\tconstructor(factory: SkuStatusFactory, locale: Locale, options: Object) {\n\t\tthis.factory = factory;\n\t\tthis.locale = locale;\n\t\tthis.options = Object.assign({}, Repository.defaults, options);\n\t\tthis._loadQueue = [];\n\t\tthis._loadPromises = {};\n\t\tthis._loadResolvers = {};\n\t\tthis._loadTimeout = null;\n\t\tthis._loaded = {};\n\t\tthis._businesses = null;\n\t}\n\n\tload(id: number) : Promise {\n\t\tif (this._loaded[id] instanceof Error) {\n\t\t\treturn Promise.reject(this._loaded[id]);\n\t\t} else if (this._loaded[id] != null) {\n\t\t\treturn Promise.resolve({\n\t\t\t\telement: this._loaded[id],\n\t\t\t\tbusinesses: this._businesses,\n\t\t\t});\n\t\t}\n\n\t\tif (this._loadPromises[id] != null) {\n\t\t\treturn this._loadPromises[id];\n\t\t}\n\n\t\tthis._loadQueue.push(id);\n\t\tthis._loadPromises[id] = new Promise((resolve, reject) => {\n\t\t\tthis._loadResolvers[id] = {\n\t\t\t\tresolve: resolve,\n\t\t\t\treject: reject,\n\t\t\t};\n\n\t\t\tif (this._loadTimeout == null) {\n\t\t\t\tthis._loadTimeout = setTimeout(this.loadStart, this.options.delay);\n\t\t\t}\n\t\t});\n\n\t\treturn this._loadPromises[id];\n\t}\n\n\tloadStart = () : void => {\n\t\tthis._loadTimeout = null;\n\n\t\tif (this._loadQueue.length === 0) { return; }\n\n\t\tconst ids = this.fulfilQueue(this._loadQueue).slice();\n\n\t\tfor (const idsChunk of this.chunkQueue(ids)) {\n\t\t\tBX.ajax({\n\t\t\t\turl: this.options.url,\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: Object.assign({}, this.options.payload, { id: idsChunk }),\n\t\t\t\tonsuccess: (response: Object) : void => {\n\t\t\t\t\tif (response == null || typeof response !== 'object' || response.status == null) {\n\t\t\t\t\t\tthis.rejectAll(ids, new Error(this.locale.message('UNKNOWN_RESPONSE_FORMAT')));\n\t\t\t\t\t} else if (response.status === 'ok') {\n\t\t\t\t\t\tthis.resolve(ids, response.data.elements, response.data.businesses);\n\t\t\t\t\t} else if (response.status === 'error') {\n\t\t\t\t\t\tthis.rejectAll(ids, new Error(response.message));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.rejectAll(ids, new Error(this.locale.message('UNKNOWN_RESPONSE_FORMAT')));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonfailure: (message, status) => {\n\t\t\t\t\tconst error = status instanceof Error ? status : new Error(`${message} ${status}`);\n\n\t\t\t\t\tthis.rejectAll(ids, error);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis._loadQueue = [];\n\t}\n\n\tresolve(ids: number[], elements: Object, businesses: Object) : void {\n\t\tthis._businesses = businesses;\n\n\t\tfor (const id of ids) {\n\t\t\tif (this._loadResolvers[id] == null) { continue; }\n\n\t\t\tif (elements[id] != null) {\n\t\t\t\tthis._loaded[id] = elements[id];\n\t\t\t\tthis._loadResolvers[id].resolve({\n\t\t\t\t\telement: elements[id],\n\t\t\t\t\tbusinesses: businesses,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst error = new Error(this.locale.message('MISSING_DATA'))\n\n\t\t\t\tthis._loaded[id] = error;\n\t\t\t\tthis._loadResolvers[id].reject(error);\n\t\t\t}\n\n\t\t\tdelete this._loadPromises[id];\n\t\t\tdelete this._loadResolvers[id];\n\t\t}\n\t}\n\n\trejectAll(ids: number, error: Error) {\n\t\tfor (const id of ids) {\n\t\t\tif (this._loadResolvers[id] == null) { continue; }\n\n\t\t\tthis._loaded = error;\n\t\t\tthis._loadResolvers[id].reject(error);\n\n\t\t\tdelete this._loadPromises[id];\n\t\t\tdelete this._loadResolvers[id];\n\t\t}\n\t}\n\n\tfulfilQueue(ids: number[]) : number[] {\n\t\tif (this.options.limit == null) { return ids; }\n\n\t\tconst limit = +this.options.limit;\n\t\tconst left = (limit - (ids.length % limit));\n\n\t\tfor (const instance of this.factory.fulfilQueue(left, ids, this._loaded)) {\n\t\t\tconst id = instance.id();\n\n\t\t\tthis._loadPromises[id] = new Promise((resolve, reject) => {\n\t\t\t\tthis._loadResolvers[id] = {\n\t\t\t\t\tresolve: resolve,\n\t\t\t\t\treject: reject,\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tinstance.waitLoad(this._loadPromises[id]);\n\t\t\tids.push(id);\n\t\t}\n\n\t\treturn ids;\n\t}\n\n\tchunkQueue(ids: number[]) : number[][] {\n\t\tif (this.options.limit == null) { return [ ids ]; }\n\n\t\tconst limit = +this.options.limit;\n\n\t\tconst chunks = [];\n\n\t\tfor (let i = 0; i < ids.length; i += limit) {\n\t\t\tchunks.push(ids.slice(i, i + limit));\n\t\t}\n\n\t\treturn chunks;\n\t}\n\n}","export class Locale {\n\n    constructor(messages: Object) {\n        this._messages = messages;\n    }\n\n    message(key: string) : string {\n        return this._messages[key] || key;\n    }\n}","import {SkuStatus} from \"./SkuStatus\";\nimport {Repository} from \"./Component/Repository\";\nimport {Locale} from \"./Component/Locale\";\n\nconst BX = (window.BX || top.BX);\n\nexport class SkuStatusFactory {\n\tstatic WAIT_TOKEN = 'wait';\n\tstatic READY_TOKEN = 'ready';\n\n\tstatic factories = {};\n\tstatic defaults = {\n\t\ttransport: null,\n\t\tlocale: {},\n\t};\n\n\tcheckTimeout: ?number;\n\n\tstatic instance(selector: string, options: Object = {}) : SkuStatusFactory {\n\t\tif (this.factories[selector] == null) {\n\t\t\tthis.factories[selector] = new this(selector, options);\n\t\t}\n\n\t\treturn this.factories[selector];\n\t}\n\n\tconstructor(selector: string, options: Object = {}) {\n\t\tthis.selector = selector;\n\t\tthis.options = Object.assign({}, SkuStatusFactory.defaults, options);\n\t\tthis.observer = new IntersectionObserver(this.onIntersect.bind(this));\n\t\tthis.locale = new Locale(this.options.locale);\n\t\tthis.transport = new Repository(this, this.locale, this.options.transport);\n\t\tthis.instances = new Map();\n\n\t\tthis.search();\n\t\tthis.bind();\n\t}\n\n\tonIntersect(entries: IntersectionObserverEntry[]) : void {\n\t\tfor (const entry of entries) {\n\t\t\tif (!entry.isIntersecting) { continue; }\n\n\t\t\tthis.make(entry.target).load();\n\t\t\tthis.observer.unobserve(entry.target);\n\t\t}\n\t}\n\n\tsearch() : void {\n\t\tfor (const element of document.querySelectorAll(this.selector)) {\n\t\t\tif (element.dataset.status != null) { continue; }\n\n\t\t\tthis.observer.observe(element);\n\t\t\telement.dataset.status = SkuStatusFactory.WAIT_TOKEN;\n\t\t}\n\t}\n\n\tmake(element: HTMLElement) : SkuStatus {\n\t\tconst instance = new SkuStatus(element, this.transport, this.locale, Object.assign({}, this.options, {\n\t\t\tid: +element.dataset.id,\n\t\t\ttheme: element.dataset.theme,\n\t\t}));\n\n\t\telement.dataset.status = SkuStatusFactory.READY_TOKEN;\n\t\tthis.instances.set(element, instance);\n\n\t\treturn instance;\n\t}\n\n\tbind() : void {\n\t\tBX.addCustomEvent('onAdminTabsChange', () => this.tryCheck());\n\t\tBX.addCustomEvent('onAjaxSuccessFinish', () => this.tryCheck());\n\t\tBX.addCustomEvent('Grid::updated', () => this.tryCheck());\n\t\tBX.addCustomEvent('Grid::thereEditedRows', () => this.tryCheck());\n\t\tBX.addCustomEvent('Grid::noEditedRows', () => this.tryCheck());\n\t}\n\n\ttryCheck() : void {\n\t\tclearTimeout(this.checkTimeout);\n\t\tthis.checkTimeout = setTimeout(() => this.check(), 50);\n\t}\n\n\tcheck() : void {\n\t\tthis.checkObserver();\n\t\tthis.checkInstances();\n\n\t\tthis.search();\n\t}\n\n\tcheckObserver() : void {\n\t\tfor (const entry of this.observer.takeRecords()) {\n\t\t\tif (document.contains(entry.target)) { continue; }\n\n\t\t\tthis.observer.unobserve(entry.target);\n\t\t}\n\t}\n\n\tcheckInstances() : void {\n\t\tfor (const element of this.instances.keys()) {\n\t\t\tif (document.contains(element)) { continue; }\n\n\t\t\tthis.instances.get(element).destroy();\n\t\t\tthis.instances.delete(element);\n\t\t}\n\t}\n\n\tfulfilQueue(left: number, requested: number[], loaded: Object<number, Object>) : SkuStatus[] {\n\t\tif (left <= 0) { return requested; }\n\n\t\tconst [ before, inside, after ] = this.splitElementsByPosition(requested, loaded);\n\t\tconst instances = [];\n\n\t\tfor (const element of this.selectNearestElements(left, before, inside, after)) {\n\t\t\tlet instance;\n\n\t\t\tif (this.instances.has(element)) {\n\t\t\t\tinstance = this.instances.get(element);\n\t\t\t} else {\n\t\t\t\tinstance =  this.make(element);\n\t\t\t\tthis.observer.unobserve(element);\n\t\t\t}\n\n\t\t\tinstances.push(instance);\n\t\t}\n\n\t\treturn instances;\n\t}\n\n\tsplitElementsByPosition(requested: number[], loaded: Object<number, Object>) : HTMLElement[][] {\n\t\tconst before = [];\n\t\tlet inside = [];\n\t\tlet after = [];\n\t\tlet foundFirst = false;\n\n\t\tfor (const element of document.querySelectorAll(this.selector)) {\n\t\t\tconst id = +element.dataset.id;\n\n\t\t\tif (id <= 0 || Number.isNaN(id)) { continue; }\n\n\t\t\tif (requested.indexOf(id) !== -1) {\n\t\t\t\tfoundFirst = true;\n\n\t\t\t\tif (after.length > 0) {\n\t\t\t\t\tinside.push(...after);\n\t\t\t\t\tafter = [];\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (loaded[id] != null) { continue; }\n\n\t\t\tif (foundFirst) {\n\t\t\t\tafter.push(element);\n\t\t\t} else {\n\t\t\t\tbefore.unshift(element);\n\t\t\t}\n\t\t}\n\n\t\treturn [ before, inside, after ];\n\t}\n\n\tselectNearestElements(left: number, before: HTMLElement[], inside: HTMLElement[], after: HTMLElement[]) : HTMLElement[] {\n\t\tif (inside.length >= left) {\n\t\t\treturn inside.slice(0, left);\n\t\t}\n\n\t\tconst nearest = [];\n\n\t\tif (inside.length > 0) {\n\t\t\tnearest.push(...inside);\n\t\t\tleft -= nearest.length;\n\t\t}\n\n\t\tconst sides = [ before, after ].filter((side: HTMLElement[]) => side.length > 0);\n\n\t\tfor (let i = left; i > 0; --i) {\n\t\t\tconst side = sides.shift();\n\n\t\t\tif (side == null) { break; }\n\n\t\t\tnearest.push(side.shift());\n\n\t\t\tif (side.length === 0) { continue; }\n\n\t\t\tsides.push(side);\n\t\t}\n\n\t\treturn nearest;\n\t}\n}"],"names":["Glossary","rating","locale","this","ratingLevel","message","BX","window","MessagePopup","messages","CAdminDialog","content","width","height","Show","Object","entries","map","type","group","_this","toUpperCase","join","View","viewport","OfferGrid","businesses","elementStatus","insideHint","evt","link","currentTarget","offer","dataset","business","show","preventDefault","parent","parentElement","title","getAttribute","remove","textContent","trim","dir","querySelectorAll","onPopupClick","onSiblingsClick","innerHTML","render","handlePopupClick","handleSiblingsClick","partials","businessStatus","html","length","name","error","renderOffers","push","offersHtml","_this2","offerName","offerSiblings","caption","text","more","commonOffersHtml","slice","additionalOffersHtml","siblings","names","_this3","util","htmlspecialchars","businessId","offerId","Error","Hint","AdminHint","anchor","showTimeout","hideTimeout","hint","CHint","show_timeout","defaults","hide_timeout","Init","Destroy","CONTENT_TEXT","originalTimeout","PARAMS","PopupHint","PopupWindow","autoHide","draggable","closeByEsc","bindElement","maxWidth","angleLeftOffset","angle","position","offset","angleOffset","querySelector","ratingRect","getBoundingClientRect","anchorRect","left","destroy","contentContainer","HintFactory","admin","SummaryRow","handleMouseOver","bootHint","showNow","offerGrid","onClick","onMouseOver","handleClick","destroyHint","create","mount","container","unmount","FailView","loader","outerHTML","SkuStatus","element","transport","options","el","assign","destroyed","destroyView","id","loading","load","then","bind","fail","promise","classList","add","response","draw","theme","view","_view","Repository","factory","_loadTimeout","_loadQueue","ids","fulfilQueue","chunkQueue","idsChunk","ajax","url","method","dataType","data","payload","onsuccess","babelHelpers","status","rejectAll","resolve","elements","onfailure","_loadPromises","_loadResolvers","_loaded","_businesses","Promise","reject","setTimeout","loadStart","delay","limit","instance","waitLoad","chunks","i","Locale","_messages","key","top","SkuStatusFactory","selector","observer","IntersectionObserver","onIntersect","instances","Map","search","factories","entry","isIntersecting","make","target","unobserve","document","observe","WAIT_TOKEN","READY_TOKEN","set","addCustomEvent","tryCheck","clearTimeout","checkTimeout","check","checkObserver","checkInstances","takeRecords","contains","keys","get","requested","loaded","splitElementsByPosition","before","inside","after","selectNearestElements","has","foundFirst","Number","isNaN","indexOf","unshift","nearest","sides","filter","side","shift"],"mappings":"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"}